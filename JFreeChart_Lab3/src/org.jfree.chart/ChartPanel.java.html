<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>ChartPanel.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">org.jfree.data (Mar 14, 2025 10:05:31â€¯p.m.)</a> &gt; <a href="../../index.html" class="el_group">JFreeChart_Lab3</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">org.jfree.chart</a> &gt; <span class="el_source">ChartPanel.java</span></div><h1>ChartPanel.java</h1><pre class="source lang-java linenums">/* ===========================================================
 * JFreeChart : a free chart library for the Java(tm) platform
 * ===========================================================
 *
 * (C) Copyright 2000-2014, by Object Refinery Limited and Contributors.
 *
 * Project Info:  http://www.jfree.org/jfreechart/index.html
 *
 * This library is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation; either version 2.1 of the License, or
 * (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public
 * License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,
 * USA.
 *
 * [Oracle and Java are registered trademarks of Oracle and/or its affiliates. 
 * Other names may be trademarks of their respective owners.]
 *
 * ---------------
 * ChartPanel.java
 * ---------------
 * (C) Copyright 2000-2014, by Object Refinery Limited and Contributors.
 *
 * Original Author:  David Gilbert (for Object Refinery Limited);
 * Contributor(s):   Andrzej Porebski;
 *                   Soren Caspersen;
 *                   Jonathan Nash;
 *                   Hans-Jurgen Greiner;
 *                   Andreas Schneider;
 *                   Daniel van Enckevort;
 *                   David M O'Donnell;
 *                   Arnaud Lelievre;
 *                   Matthias Rose;
 *                   Onno vd Akker;
 *                   Sergei Ivanov;
 *                   Ulrich Voigt - patch 2686040;
 *                   Alessandro Borges - patch 1460845;
 *                   Martin Hoeller;
 *
 * Changes (from 28-Jun-2001)
 * --------------------------
 * 28-Jun-2001 : Integrated buffering code contributed by S???ren
 *               Caspersen (DG);
 * 18-Sep-2001 : Updated header and fixed DOS encoding problem (DG);
 * 22-Nov-2001 : Added scaling to improve display of charts in small sizes (DG);
 * 26-Nov-2001 : Added property editing, saving and printing (DG);
 * 11-Dec-2001 : Transferred saveChartAsPNG method to new ChartUtilities
 *               class (DG);
 * 13-Dec-2001 : Added tooltips (DG);
 * 16-Jan-2002 : Added an optional crosshair, based on the implementation by
 *               Jonathan Nash. Renamed the tooltips class (DG);
 * 23-Jan-2002 : Implemented zooming based on code by Hans-Jurgen Greiner (DG);
 * 05-Feb-2002 : Improved tooltips setup.  Renamed method attemptSaveAs()
 *               --&gt; doSaveAs() and made it public rather than private (DG);
 * 28-Mar-2002 : Added a new constructor (DG);
 * 09-Apr-2002 : Changed initialisation of tooltip generation, as suggested by
 *               Hans-Jurgen Greiner (DG);
 * 27-May-2002 : New interactive zooming methods based on code by Hans-Jurgen
 *               Greiner. Renamed JFreeChartPanel --&gt; ChartPanel, moved
 *               constants to ChartPanelConstants interface (DG);
 * 31-May-2002 : Fixed a bug with interactive zooming and added a way to
 *               control if the zoom rectangle is filled in or drawn as an
 *               outline. A mouse drag gesture towards the top left now causes
 *               an autoRangeBoth() and is a way to undo zooms (AS);
 * 11-Jun-2002 : Reinstated handleClick method call in mouseClicked() to get
 *               crosshairs working again (DG);
 * 13-Jun-2002 : Added check for null popup menu in mouseDragged method (DG);
 * 18-Jun-2002 : Added get/set methods for minimum and maximum chart
 *               dimensions (DG);
 * 25-Jun-2002 : Removed redundant code (DG);
 * 27-Aug-2002 : Added get/set methods for popup menu (DG);
 * 26-Sep-2002 : Fixed errors reported by Checkstyle (DG);
 * 22-Oct-2002 : Added translation methods for screen &lt;--&gt; Java2D, contributed
 *               by Daniel van Enckevort (DG);
 * 05-Nov-2002 : Added a chart reference to the ChartMouseEvent class (DG);
 * 22-Nov-2002 : Added test in zoom method for inverted axes, supplied by
 *               David M O'Donnell (DG);
 * 14-Jan-2003 : Implemented ChartProgressListener interface (DG);
 * 14-Feb-2003 : Removed deprecated setGenerateTooltips method (DG);
 * 12-Mar-2003 : Added option to enforce filename extension (see bug id
 *               643173) (DG);
 * 08-Sep-2003 : Added internationalization via use of properties
 *               resourceBundle (RFE 690236) (AL);
 * 18-Sep-2003 : Added getScaleX() and getScaleY() methods (protected) as
 *               requested by Irv Thomae (DG);
 * 12-Nov-2003 : Added zooming support for the FastScatterPlot class (DG);
 * 24-Nov-2003 : Minor Javadoc updates (DG);
 * 04-Dec-2003 : Added anchor point for crosshair calculation (DG);
 * 17-Jan-2004 : Added new methods to set tooltip delays to be used in this
 *               chart panel. Refer to patch 877565 (MR);
 * 02-Feb-2004 : Fixed bug in zooming trigger and added zoomTriggerDistance
 *               attribute (DG);
 * 08-Apr-2004 : Changed getScaleX() and getScaleY() from protected to
 *               public (DG);
 * 15-Apr-2004 : Added zoomOutFactor and zoomInFactor (DG);
 * 21-Apr-2004 : Fixed zooming bug in mouseReleased() method (DG);
 * 13-Jul-2004 : Added check for null chart (DG);
 * 04-Oct-2004 : Renamed ShapeUtils --&gt; ShapeUtilities (DG);
 * 11-Nov-2004 : Moved constants back in from ChartPanelConstants (DG);
 * 12-Nov-2004 : Modified zooming mechanism to support zooming within
 *               subplots (DG);
 * 26-Jan-2005 : Fixed mouse zooming for horizontal category plots (DG);
 * 11-Apr-2005 : Added getFillZoomRectangle() method, renamed
 *               setHorizontalZoom() --&gt; setDomainZoomable(),
 *               setVerticalZoom() --&gt; setRangeZoomable(), added
 *               isDomainZoomable() and isRangeZoomable(), added
 *               getHorizontalAxisTrace() and getVerticalAxisTrace(),
 *               renamed autoRangeBoth() --&gt; restoreAutoBounds(),
 *               autoRangeHorizontal() --&gt; restoreAutoDomainBounds(),
 *               autoRangeVertical() --&gt; restoreAutoRangeBounds() (DG);
 * 12-Apr-2005 : Removed working areas, added getAnchorPoint() method,
 *               added protected accessors for tracelines (DG);
 * 18-Apr-2005 : Made constants final (DG);
 * 26-Apr-2005 : Removed LOGGER (DG);
 * 01-Jun-2005 : Fixed zooming for combined plots - see bug report
 *               1212039, fix thanks to Onno vd Akker (DG);
 * 25-Nov-2005 : Reworked event listener mechanism (DG);
 * ------------- JFREECHART 1.0.x ---------------------------------------------
 * 01-Aug-2006 : Fixed minor bug in restoreAutoRangeBounds() (DG);
 * 04-Sep-2006 : Renamed attemptEditChartProperties() --&gt;
 *               doEditChartProperties() and made public (DG);
 * 13-Sep-2006 : Don't generate ChartMouseEvents if the panel's chart is null
 *               (fixes bug 1556951) (DG);
 * 05-Mar-2007 : Applied patch 1672561 by Sergei Ivanov, to fix zoom rectangle
 *               drawing for dynamic charts (DG);
 * 17-Apr-2007 : Fix NullPointerExceptions in zooming for combined plots (DG);
 * 24-May-2007 : When the look-and-feel changes, update the popup menu if there
 *               is one (DG);
 * 06-Jun-2007 : Fixed coordinates for drawing buffer image (DG);
 * 24-Sep-2007 : Added zoomAroundAnchor flag, and handle clearing of chart
 *               buffer (DG);
 * 25-Oct-2007 : Added default directory attribute (DG);
 * 07-Nov-2007 : Fixed (rare) bug in refreshing off-screen image (DG);
 * 07-May-2008 : Fixed bug in zooming that triggered zoom for a rectangle
 *               outside of the data area (DG);
 * 08-May-2008 : Fixed serialization bug (DG);
 * 15-Aug-2008 : Increased default maxDrawWidth/Height (DG);
 * 18-Sep-2008 : Modified creation of chart buffer (DG);
 * 18-Dec-2008 : Use ResourceBundleWrapper - see patch 1607918 by
 *               Jess Thrysoee (DG);
 * 13-Jan-2009 : Fixed zooming methods to trigger only one plot
 *               change event (DG);
 * 16-Jan-2009 : Use XOR for zoom rectangle only if useBuffer is false (DG);
 * 18-Mar-2009 : Added mouse wheel support (DG);
 * 19-Mar-2009 : Added panning on mouse drag support - based on Ulrich 
 *               Voigt's patch 2686040 (DG);
 * 26-Mar-2009 : Changed fillZoomRectangle default to true, and only change
 *               cursor for CTRL-mouse-click if panning is enabled (DG);
 * 01-Apr-2009 : Fixed panning, and added different mouse event mask for
 *               MacOSX (DG);
 * 08-Apr-2009 : Added copy to clipboard support, based on patch 1460845
 *               by Alessandro Borges (DG);
 * 09-Apr-2009 : Added overlay support (DG);
 * 10-Apr-2009 : Set chartBuffer background to match ChartPanel (DG);
 * 05-May-2009 : Match scaling (and insets) in doCopy() (DG);
 * 01-Jun-2009 : Check for null chart in mousePressed() method (DG);
 * 08-Jun-2009 : Fixed bug in setMouseWheelEnabled() (DG);
 * 06-Jul-2009 : Clear off-screen buffer to fully transparent (DG);
 * 10-Oct-2011 : localization fix: bug #3353913 (MH);
 * 05-Jul-2012 : Remove reflection for MouseWheelListener - only needed for 
 *               JRE 1.3.1 (DG);
 * 02-Jul-2013 : Use ParamChecks class (DG);
 * 12-Sep-2013 : Provide auto-detection for JFreeSVG and OrsonPDF 
 *               libraries (no compile time dependencies) (DG);
 * 
 */

package org.jfree.chart;

import java.awt.AWTEvent;
import java.awt.AlphaComposite;
import java.awt.Color;
import java.awt.Composite;
import java.awt.Cursor;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.GraphicsConfiguration;
import java.awt.Image;
import java.awt.Insets;
import java.awt.Paint;
import java.awt.Point;
import java.awt.Rectangle;
import java.awt.Toolkit;
import java.awt.Transparency;
import java.awt.datatransfer.Clipboard;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.InputEvent;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.awt.event.MouseMotionListener;
import java.awt.geom.AffineTransform;
import java.awt.geom.Line2D;
import java.awt.geom.Point2D;
import java.awt.geom.Rectangle2D;
import java.awt.print.PageFormat;
import java.awt.print.Printable;
import java.awt.print.PrinterException;
import java.awt.print.PrinterJob;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.io.Serializable;
import java.lang.reflect.Constructor;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.EventListener;
import java.util.Iterator;
import java.util.List;
import java.util.ResourceBundle;

import javax.swing.JFileChooser;
import javax.swing.JMenu;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JPopupMenu;
import javax.swing.SwingUtilities;
import javax.swing.ToolTipManager;
import javax.swing.event.EventListenerList;
import javax.swing.filechooser.FileNameExtensionFilter;

import org.jfree.chart.editor.ChartEditor;
import org.jfree.chart.editor.ChartEditorManager;
import org.jfree.chart.entity.ChartEntity;
import org.jfree.chart.entity.EntityCollection;
import org.jfree.chart.event.ChartChangeEvent;
import org.jfree.chart.event.ChartChangeListener;
import org.jfree.chart.event.ChartProgressEvent;
import org.jfree.chart.event.ChartProgressListener;
import org.jfree.chart.panel.Overlay;
import org.jfree.chart.event.OverlayChangeEvent;
import org.jfree.chart.event.OverlayChangeListener;
import org.jfree.chart.plot.Pannable;
import org.jfree.chart.plot.Plot;
import org.jfree.chart.plot.PlotOrientation;
import org.jfree.chart.plot.PlotRenderingInfo;
import org.jfree.chart.plot.Zoomable;
import org.jfree.chart.util.ParamChecks;
import org.jfree.chart.util.ResourceBundleWrapper;
import org.jfree.io.SerialUtilities;

/**
 * A Swing GUI component for displaying a {@link JFreeChart} object.
 * &lt;P&gt;
 * The panel registers with the chart to receive notification of changes to any
 * component of the chart.  The chart is redrawn automatically whenever this
 * notification is received.
 */
public class ChartPanel extends JPanel implements ChartChangeListener,
        ChartProgressListener, ActionListener, MouseListener,
        MouseMotionListener, OverlayChangeListener, Printable, Serializable {

    /** For serialization. */
    private static final long serialVersionUID = 6046366297214274674L;

    /**
     * Default setting for buffer usage.  The default has been changed to
     * &lt;code&gt;true&lt;/code&gt; from version 1.0.13 onwards, because of a severe
     * performance problem with drawing the zoom rectangle using XOR (which
     * now happens only when the buffer is NOT used).
     */
    public static final boolean DEFAULT_BUFFER_USED = true;

    /** The default panel width. */
    public static final int DEFAULT_WIDTH = 680;

    /** The default panel height. */
    public static final int DEFAULT_HEIGHT = 420;

    /** The default limit below which chart scaling kicks in. */
    public static final int DEFAULT_MINIMUM_DRAW_WIDTH = 300;

    /** The default limit below which chart scaling kicks in. */
    public static final int DEFAULT_MINIMUM_DRAW_HEIGHT = 200;

    /** The default limit above which chart scaling kicks in. */
    public static final int DEFAULT_MAXIMUM_DRAW_WIDTH = 1024;

    /** The default limit above which chart scaling kicks in. */
    public static final int DEFAULT_MAXIMUM_DRAW_HEIGHT = 768;

    /** The minimum size required to perform a zoom on a rectangle */
    public static final int DEFAULT_ZOOM_TRIGGER_DISTANCE = 10;

    /** Properties action command. */
    public static final String PROPERTIES_COMMAND = &quot;PROPERTIES&quot;;

    /**
     * Copy action command.
     *
     * @since 1.0.13
     */
    public static final String COPY_COMMAND = &quot;COPY&quot;;

    /** Save action command. */
    public static final String SAVE_COMMAND = &quot;SAVE&quot;;

    /** Action command to save as PNG. */
    private static final String SAVE_AS_PNG_COMMAND = &quot;SAVE_AS_PNG&quot;;
    
    /** Action command to save as SVG. */
    private static final String SAVE_AS_SVG_COMMAND = &quot;SAVE_AS_SVG&quot;;
    
    /** Action command to save as PDF. */
    private static final String SAVE_AS_PDF_COMMAND = &quot;SAVE_AS_PDF&quot;;
    
    /** Print action command. */
    public static final String PRINT_COMMAND = &quot;PRINT&quot;;

    /** Zoom in (both axes) action command. */
    public static final String ZOOM_IN_BOTH_COMMAND = &quot;ZOOM_IN_BOTH&quot;;

    /** Zoom in (domain axis only) action command. */
    public static final String ZOOM_IN_DOMAIN_COMMAND = &quot;ZOOM_IN_DOMAIN&quot;;

    /** Zoom in (range axis only) action command. */
    public static final String ZOOM_IN_RANGE_COMMAND = &quot;ZOOM_IN_RANGE&quot;;

    /** Zoom out (both axes) action command. */
    public static final String ZOOM_OUT_BOTH_COMMAND = &quot;ZOOM_OUT_BOTH&quot;;

    /** Zoom out (domain axis only) action command. */
    public static final String ZOOM_OUT_DOMAIN_COMMAND = &quot;ZOOM_DOMAIN_BOTH&quot;;

    /** Zoom out (range axis only) action command. */
    public static final String ZOOM_OUT_RANGE_COMMAND = &quot;ZOOM_RANGE_BOTH&quot;;

    /** Zoom reset (both axes) action command. */
    public static final String ZOOM_RESET_BOTH_COMMAND = &quot;ZOOM_RESET_BOTH&quot;;

    /** Zoom reset (domain axis only) action command. */
    public static final String ZOOM_RESET_DOMAIN_COMMAND = &quot;ZOOM_RESET_DOMAIN&quot;;

    /** Zoom reset (range axis only) action command. */
    public static final String ZOOM_RESET_RANGE_COMMAND = &quot;ZOOM_RESET_RANGE&quot;;

    /** The chart that is displayed in the panel. */
    private JFreeChart chart;

    /** Storage for registered (chart) mouse listeners. */
    private transient EventListenerList chartMouseListeners;

    /** A flag that controls whether or not the off-screen buffer is used. */
    private boolean useBuffer;

    /** A flag that indicates that the buffer should be refreshed. */
    private boolean refreshBuffer;

    /** A buffer for the rendered chart. */
    private transient Image chartBuffer;

    /** The height of the chart buffer. */
    private int chartBufferHeight;

    /** The width of the chart buffer. */
    private int chartBufferWidth;

    /**
     * The minimum width for drawing a chart (uses scaling for smaller widths).
     */
    private int minimumDrawWidth;

    /**
     * The minimum height for drawing a chart (uses scaling for smaller
     * heights).
     */
    private int minimumDrawHeight;

    /**
     * The maximum width for drawing a chart (uses scaling for bigger
     * widths).
     */
    private int maximumDrawWidth;

    /**
     * The maximum height for drawing a chart (uses scaling for bigger
     * heights).
     */
    private int maximumDrawHeight;

    /** The popup menu for the frame. */
    private JPopupMenu popup;

    /** The drawing info collected the last time the chart was drawn. */
    private ChartRenderingInfo info;

    /** The chart anchor point. */
    private Point2D anchor;

    /** The scale factor used to draw the chart. */
    private double scaleX;

    /** The scale factor used to draw the chart. */
    private double scaleY;

    /** The plot orientation. */
<span class="nc" id="L410">    private PlotOrientation orientation = PlotOrientation.VERTICAL;</span>

    /** A flag that controls whether or not domain zooming is enabled. */
<span class="nc" id="L413">    private boolean domainZoomable = false;</span>

    /** A flag that controls whether or not range zooming is enabled. */
<span class="nc" id="L416">    private boolean rangeZoomable = false;</span>

    /**
     * The zoom rectangle starting point (selected by the user with a mouse
     * click).  This is a point on the screen, not the chart (which may have
     * been scaled up or down to fit the panel).
     */
<span class="nc" id="L423">    private Point2D zoomPoint = null;</span>

    /** The zoom rectangle (selected by the user with the mouse). */
<span class="nc" id="L426">    private transient Rectangle2D zoomRectangle = null;</span>

    /** Controls if the zoom rectangle is drawn as an outline or filled. */
<span class="nc" id="L429">    private boolean fillZoomRectangle = true;</span>

    /** The minimum distance required to drag the mouse to trigger a zoom. */
    private int zoomTriggerDistance;

    /** A flag that controls whether or not horizontal tracing is enabled. */
<span class="nc" id="L435">    private boolean horizontalAxisTrace = false;</span>

    /** A flag that controls whether or not vertical tracing is enabled. */
<span class="nc" id="L438">    private boolean verticalAxisTrace = false;</span>

    /** A vertical trace line. */
    private transient Line2D verticalTraceLine;

    /** A horizontal trace line. */
    private transient Line2D horizontalTraceLine;

    /** Menu item for zooming in on a chart (both axes). */
    private JMenuItem zoomInBothMenuItem;

    /** Menu item for zooming in on a chart (domain axis). */
    private JMenuItem zoomInDomainMenuItem;

    /** Menu item for zooming in on a chart (range axis). */
    private JMenuItem zoomInRangeMenuItem;

    /** Menu item for zooming out on a chart. */
    private JMenuItem zoomOutBothMenuItem;

    /** Menu item for zooming out on a chart (domain axis). */
    private JMenuItem zoomOutDomainMenuItem;

    /** Menu item for zooming out on a chart (range axis). */
    private JMenuItem zoomOutRangeMenuItem;

    /** Menu item for resetting the zoom (both axes). */
    private JMenuItem zoomResetBothMenuItem;

    /** Menu item for resetting the zoom (domain axis only). */
    private JMenuItem zoomResetDomainMenuItem;

    /** Menu item for resetting the zoom (range axis only). */
    private JMenuItem zoomResetRangeMenuItem;

    /**
     * The default directory for saving charts to file.
     *
     * @since 1.0.7
     */
    private File defaultDirectoryForSaveAs;

    /** A flag that controls whether or not file extensions are enforced. */
    private boolean enforceFileExtensions;

    /** A flag that indicates if original tooltip delays are changed. */
    private boolean ownToolTipDelaysActive;

    /** Original initial tooltip delay of ToolTipManager.sharedInstance(). */
    private int originalToolTipInitialDelay;

    /** Original reshow tooltip delay of ToolTipManager.sharedInstance(). */
    private int originalToolTipReshowDelay;

    /** Original dismiss tooltip delay of ToolTipManager.sharedInstance(). */
    private int originalToolTipDismissDelay;

    /** Own initial tooltip delay to be used in this chart panel. */
    private int ownToolTipInitialDelay;

    /** Own reshow tooltip delay to be used in this chart panel. */
    private int ownToolTipReshowDelay;

    /** Own dismiss tooltip delay to be used in this chart panel. */
    private int ownToolTipDismissDelay;

    /** The factor used to zoom in on an axis range. */
<span class="nc" id="L505">    private double zoomInFactor = 0.5;</span>

    /** The factor used to zoom out on an axis range. */
<span class="nc" id="L508">    private double zoomOutFactor = 2.0;</span>

    /**
     * A flag that controls whether zoom operations are centred on the
     * current anchor point, or the centre point of the relevant axis.
     *
     * @since 1.0.7
     */
    private boolean zoomAroundAnchor;

    /**
     * The paint used to draw the zoom rectangle outline.
     *
     * @since 1.0.13
     */
    private transient Paint zoomOutlinePaint;

    /**
     * The zoom fill paint (should use transparency).
     *
     * @since 1.0.13
     */
    private transient Paint zoomFillPaint;

    /** The resourceBundle for the localization. */
<span class="nc" id="L533">    protected static ResourceBundle localizationResources</span>
<span class="nc" id="L534">            = ResourceBundleWrapper.getBundle(</span>
<span class="nc" id="L535">                    &quot;org.jfree.chart.LocalizationBundle&quot;);</span>

    /** 
     * Temporary storage for the width and height of the chart 
     * drawing area during panning.
     */
    private double panW, panH;

    /** The last mouse position during panning. */
    private Point panLast;

    /**
     * The mask for mouse events to trigger panning.
     *
     * @since 1.0.13
     */
<span class="nc" id="L551">    private int panMask = InputEvent.CTRL_MASK;</span>

    /**
     * A list of overlays for the panel.
     *
     * @since 1.0.13
     */
    private List overlays;
    
    /**
     * Constructs a panel that displays the specified chart.
     *
     * @param chart  the chart.
     */
    public ChartPanel(JFreeChart chart) {

<span class="nc" id="L567">        this(</span>
<span class="nc" id="L568">            chart,</span>
<span class="nc" id="L569">            DEFAULT_WIDTH,</span>
<span class="nc" id="L570">            DEFAULT_HEIGHT,</span>
<span class="nc" id="L571">            DEFAULT_MINIMUM_DRAW_WIDTH,</span>
<span class="nc" id="L572">            DEFAULT_MINIMUM_DRAW_HEIGHT,</span>
<span class="nc" id="L573">            DEFAULT_MAXIMUM_DRAW_WIDTH,</span>
<span class="nc" id="L574">            DEFAULT_MAXIMUM_DRAW_HEIGHT,</span>
<span class="nc" id="L575">            DEFAULT_BUFFER_USED,</span>
<span class="nc" id="L576">            true,  // properties</span>
<span class="nc" id="L577">            true,  // save</span>
<span class="nc" id="L578">            true,  // print</span>
<span class="nc" id="L579">            true,  // zoom</span>
<span class="nc" id="L580">            true   // tooltips</span>
        );

<span class="nc" id="L583">    }</span>

    /**
     * Constructs a panel containing a chart.  The &lt;code&gt;useBuffer&lt;/code&gt; flag
     * controls whether or not an offscreen &lt;code&gt;BufferedImage&lt;/code&gt; is
     * maintained for the chart.  If the buffer is used, more memory is
     * consumed, but panel repaints will be a lot quicker in cases where the
     * chart itself hasn't changed (for example, when another frame is moved
     * to reveal the panel).  WARNING: If you set the &lt;code&gt;useBuffer&lt;/code&gt;
     * flag to false, note that the mouse zooming rectangle will (in that case)
     * be drawn using XOR, and there is a SEVERE performance problem with that
     * on JRE6 on Windows.
     *
     * @param chart  the chart.
     * @param useBuffer  a flag controlling whether or not an off-screen buffer
     *                   is used (read the warning above before setting this
     *                   to &lt;code&gt;false&lt;/code&gt;).
     */
    public ChartPanel(JFreeChart chart, boolean useBuffer) {

<span class="nc" id="L603">        this(chart, DEFAULT_WIDTH, DEFAULT_HEIGHT, DEFAULT_MINIMUM_DRAW_WIDTH,</span>
<span class="nc" id="L604">                DEFAULT_MINIMUM_DRAW_HEIGHT, DEFAULT_MAXIMUM_DRAW_WIDTH,</span>
<span class="nc" id="L605">                DEFAULT_MAXIMUM_DRAW_HEIGHT, useBuffer,</span>
<span class="nc" id="L606">                true,  // properties</span>
<span class="nc" id="L607">                true,  // save</span>
<span class="nc" id="L608">                true,  // print</span>
<span class="nc" id="L609">                true,  // zoom</span>
<span class="nc" id="L610">                true   // tooltips</span>
                );

<span class="nc" id="L613">    }</span>

    /**
     * Constructs a JFreeChart panel.
     *
     * @param chart  the chart.
     * @param properties  a flag indicating whether or not the chart property
     *                    editor should be available via the popup menu.
     * @param save  a flag indicating whether or not save options should be
     *              available via the popup menu.
     * @param print  a flag indicating whether or not the print option
     *               should be available via the popup menu.
     * @param zoom  a flag indicating whether or not zoom options should
     *              be added to the popup menu.
     * @param tooltips  a flag indicating whether or not tooltips should be
     *                  enabled for the chart.
     */
    public ChartPanel(JFreeChart chart,
                      boolean properties,
                      boolean save,
                      boolean print,
                      boolean zoom,
                      boolean tooltips) {

<span class="nc" id="L637">        this(chart,</span>
<span class="nc" id="L638">             DEFAULT_WIDTH,</span>
<span class="nc" id="L639">             DEFAULT_HEIGHT,</span>
<span class="nc" id="L640">             DEFAULT_MINIMUM_DRAW_WIDTH,</span>
<span class="nc" id="L641">             DEFAULT_MINIMUM_DRAW_HEIGHT,</span>
<span class="nc" id="L642">             DEFAULT_MAXIMUM_DRAW_WIDTH,</span>
<span class="nc" id="L643">             DEFAULT_MAXIMUM_DRAW_HEIGHT,</span>
<span class="nc" id="L644">             DEFAULT_BUFFER_USED,</span>
<span class="nc" id="L645">             properties,</span>
<span class="nc" id="L646">             save,</span>
<span class="nc" id="L647">             print,</span>
<span class="nc" id="L648">             zoom,</span>
<span class="nc" id="L649">             tooltips</span>
             );

<span class="nc" id="L652">    }</span>

    /**
     * Constructs a JFreeChart panel.
     *
     * @param chart  the chart.
     * @param width  the preferred width of the panel.
     * @param height  the preferred height of the panel.
     * @param minimumDrawWidth  the minimum drawing width.
     * @param minimumDrawHeight  the minimum drawing height.
     * @param maximumDrawWidth  the maximum drawing width.
     * @param maximumDrawHeight  the maximum drawing height.
     * @param useBuffer  a flag that indicates whether to use the off-screen
     *                   buffer to improve performance (at the expense of
     *                   memory).
     * @param properties  a flag indicating whether or not the chart property
     *                    editor should be available via the popup menu.
     * @param save  a flag indicating whether or not save options should be
     *              available via the popup menu.
     * @param print  a flag indicating whether or not the print option
     *               should be available via the popup menu.
     * @param zoom  a flag indicating whether or not zoom options should be
     *              added to the popup menu.
     * @param tooltips  a flag indicating whether or not tooltips should be
     *                  enabled for the chart.
     */
    public ChartPanel(JFreeChart chart, int width, int height,
            int minimumDrawWidth, int minimumDrawHeight, int maximumDrawWidth,
            int maximumDrawHeight, boolean useBuffer, boolean properties,
            boolean save, boolean print, boolean zoom, boolean tooltips) {

<span class="nc" id="L683">        this(chart, width, height, minimumDrawWidth, minimumDrawHeight,</span>
<span class="nc" id="L684">                maximumDrawWidth, maximumDrawHeight, useBuffer, properties,</span>
<span class="nc" id="L685">                true, save, print, zoom, tooltips);</span>
<span class="nc" id="L686">    }</span>

    /**
     * Constructs a JFreeChart panel.
     *
     * @param chart  the chart.
     * @param width  the preferred width of the panel.
     * @param height  the preferred height of the panel.
     * @param minimumDrawWidth  the minimum drawing width.
     * @param minimumDrawHeight  the minimum drawing height.
     * @param maximumDrawWidth  the maximum drawing width.
     * @param maximumDrawHeight  the maximum drawing height.
     * @param useBuffer  a flag that indicates whether to use the off-screen
     *                   buffer to improve performance (at the expense of
     *                   memory).
     * @param properties  a flag indicating whether or not the chart property
     *                    editor should be available via the popup menu.
     * @param copy  a flag indicating whether or not a copy option should be
     *              available via the popup menu.
     * @param save  a flag indicating whether or not save options should be
     *              available via the popup menu.
     * @param print  a flag indicating whether or not the print option
     *               should be available via the popup menu.
     * @param zoom  a flag indicating whether or not zoom options should be
     *              added to the popup menu.
     * @param tooltips  a flag indicating whether or not tooltips should be
     *                  enabled for the chart.
     *
     * @since 1.0.13
     */
<span class="nc" id="L716">    public ChartPanel(JFreeChart chart, int width, int height,</span>
           int minimumDrawWidth, int minimumDrawHeight, int maximumDrawWidth,
           int maximumDrawHeight, boolean useBuffer, boolean properties,
           boolean copy, boolean save, boolean print, boolean zoom,
           boolean tooltips) {

<span class="nc" id="L722">        setChart(chart);</span>
<span class="nc" id="L723">        this.chartMouseListeners = new EventListenerList();</span>
<span class="nc" id="L724">        this.info = new ChartRenderingInfo();</span>
<span class="nc" id="L725">        setPreferredSize(new Dimension(width, height));</span>
<span class="nc" id="L726">        this.useBuffer = useBuffer;</span>
<span class="nc" id="L727">        this.refreshBuffer = false;</span>
<span class="nc" id="L728">        this.minimumDrawWidth = minimumDrawWidth;</span>
<span class="nc" id="L729">        this.minimumDrawHeight = minimumDrawHeight;</span>
<span class="nc" id="L730">        this.maximumDrawWidth = maximumDrawWidth;</span>
<span class="nc" id="L731">        this.maximumDrawHeight = maximumDrawHeight;</span>
<span class="nc" id="L732">        this.zoomTriggerDistance = DEFAULT_ZOOM_TRIGGER_DISTANCE;</span>

        // set up popup menu...
<span class="nc" id="L735">        this.popup = null;</span>
<span class="nc bnc" id="L736" title="All 10 branches missed.">        if (properties || copy || save || print || zoom) {</span>
<span class="nc" id="L737">            this.popup = createPopupMenu(properties, copy, save, print, zoom);</span>
        }

<span class="nc" id="L740">        enableEvents(AWTEvent.MOUSE_EVENT_MASK);</span>
<span class="nc" id="L741">        enableEvents(AWTEvent.MOUSE_MOTION_EVENT_MASK);</span>
<span class="nc" id="L742">        setDisplayToolTips(tooltips);</span>
<span class="nc" id="L743">        addMouseListener(this);</span>
<span class="nc" id="L744">        addMouseMotionListener(this);</span>

<span class="nc" id="L746">        this.defaultDirectoryForSaveAs = null;</span>
<span class="nc" id="L747">        this.enforceFileExtensions = true;</span>

        // initialize ChartPanel-specific tool tip delays with
        // values the from ToolTipManager.sharedInstance()
<span class="nc" id="L751">        ToolTipManager ttm = ToolTipManager.sharedInstance();</span>
<span class="nc" id="L752">        this.ownToolTipInitialDelay = ttm.getInitialDelay();</span>
<span class="nc" id="L753">        this.ownToolTipDismissDelay = ttm.getDismissDelay();</span>
<span class="nc" id="L754">        this.ownToolTipReshowDelay = ttm.getReshowDelay();</span>

<span class="nc" id="L756">        this.zoomAroundAnchor = false;</span>
<span class="nc" id="L757">        this.zoomOutlinePaint = Color.blue;</span>
<span class="nc" id="L758">        this.zoomFillPaint = new Color(0, 0, 255, 63);</span>

<span class="nc" id="L760">        this.panMask = InputEvent.CTRL_MASK;</span>
        // for MacOSX we can't use the CTRL key for mouse drags, see:
        // http://developer.apple.com/qa/qa2004/qa1362.html
<span class="nc" id="L763">        String osName = System.getProperty(&quot;os.name&quot;).toLowerCase();</span>
<span class="nc bnc" id="L764" title="All 2 branches missed.">        if (osName.startsWith(&quot;mac os x&quot;)) {</span>
<span class="nc" id="L765">            this.panMask = InputEvent.ALT_MASK;</span>
        }

<span class="nc" id="L768">        this.overlays = new java.util.ArrayList();</span>
<span class="nc" id="L769">    }</span>

    /**
     * Returns the chart contained in the panel.
     *
     * @return The chart (possibly &lt;code&gt;null&lt;/code&gt;).
     */
    public JFreeChart getChart() {
<span class="nc" id="L777">        return this.chart;</span>
    }

    /**
     * Sets the chart that is displayed in the panel.
     *
     * @param chart  the chart (&lt;code&gt;null&lt;/code&gt; permitted).
     */
    public void setChart(JFreeChart chart) {

        // stop listening for changes to the existing chart
<span class="nc bnc" id="L788" title="All 2 branches missed.">        if (this.chart != null) {</span>
<span class="nc" id="L789">            this.chart.removeChangeListener(this);</span>
<span class="nc" id="L790">            this.chart.removeProgressListener(this);</span>
        }

        // add the new chart
<span class="nc" id="L794">        this.chart = chart;</span>
<span class="nc bnc" id="L795" title="All 2 branches missed.">        if (chart != null) {</span>
<span class="nc" id="L796">            this.chart.addChangeListener(this);</span>
<span class="nc" id="L797">            this.chart.addProgressListener(this);</span>
<span class="nc" id="L798">            Plot plot = chart.getPlot();</span>
<span class="nc" id="L799">            this.domainZoomable = false;</span>
<span class="nc" id="L800">            this.rangeZoomable = false;</span>
<span class="nc bnc" id="L801" title="All 2 branches missed.">            if (plot instanceof Zoomable) {</span>
<span class="nc" id="L802">                Zoomable z = (Zoomable) plot;</span>
<span class="nc" id="L803">                this.domainZoomable = z.isDomainZoomable();</span>
<span class="nc" id="L804">                this.rangeZoomable = z.isRangeZoomable();</span>
<span class="nc" id="L805">                this.orientation = z.getOrientation();</span>
            }
<span class="nc" id="L807">        }</span>
        else {
<span class="nc" id="L809">            this.domainZoomable = false;</span>
<span class="nc" id="L810">            this.rangeZoomable = false;</span>
        }
<span class="nc bnc" id="L812" title="All 2 branches missed.">        if (this.useBuffer) {</span>
<span class="nc" id="L813">            this.refreshBuffer = true;</span>
        }
<span class="nc" id="L815">        repaint();</span>

<span class="nc" id="L817">    }</span>

    /**
     * Returns the minimum drawing width for charts.
     * &lt;P&gt;
     * If the width available on the panel is less than this, then the chart is
     * drawn at the minimum width then scaled down to fit.
     *
     * @return The minimum drawing width.
     */
    public int getMinimumDrawWidth() {
<span class="nc" id="L828">        return this.minimumDrawWidth;</span>
    }

    /**
     * Sets the minimum drawing width for the chart on this panel.
     * &lt;P&gt;
     * At the time the chart is drawn on the panel, if the available width is
     * less than this amount, the chart will be drawn using the minimum width
     * then scaled down to fit the available space.
     *
     * @param width  The width.
     */
    public void setMinimumDrawWidth(int width) {
<span class="nc" id="L841">        this.minimumDrawWidth = width;</span>
<span class="nc" id="L842">    }</span>

    /**
     * Returns the maximum drawing width for charts.
     * &lt;P&gt;
     * If the width available on the panel is greater than this, then the chart
     * is drawn at the maximum width then scaled up to fit.
     *
     * @return The maximum drawing width.
     */
    public int getMaximumDrawWidth() {
<span class="nc" id="L853">        return this.maximumDrawWidth;</span>
    }

    /**
     * Sets the maximum drawing width for the chart on this panel.
     * &lt;P&gt;
     * At the time the chart is drawn on the panel, if the available width is
     * greater than this amount, the chart will be drawn using the maximum
     * width then scaled up to fit the available space.
     *
     * @param width  The width.
     */
    public void setMaximumDrawWidth(int width) {
<span class="nc" id="L866">        this.maximumDrawWidth = width;</span>
<span class="nc" id="L867">    }</span>

    /**
     * Returns the minimum drawing height for charts.
     * &lt;P&gt;
     * If the height available on the panel is less than this, then the chart
     * is drawn at the minimum height then scaled down to fit.
     *
     * @return The minimum drawing height.
     */
    public int getMinimumDrawHeight() {
<span class="nc" id="L878">        return this.minimumDrawHeight;</span>
    }

    /**
     * Sets the minimum drawing height for the chart on this panel.
     * &lt;P&gt;
     * At the time the chart is drawn on the panel, if the available height is
     * less than this amount, the chart will be drawn using the minimum height
     * then scaled down to fit the available space.
     *
     * @param height  The height.
     */
    public void setMinimumDrawHeight(int height) {
<span class="nc" id="L891">        this.minimumDrawHeight = height;</span>
<span class="nc" id="L892">    }</span>

    /**
     * Returns the maximum drawing height for charts.
     * &lt;P&gt;
     * If the height available on the panel is greater than this, then the
     * chart is drawn at the maximum height then scaled up to fit.
     *
     * @return The maximum drawing height.
     */
    public int getMaximumDrawHeight() {
<span class="nc" id="L903">        return this.maximumDrawHeight;</span>
    }

    /**
     * Sets the maximum drawing height for the chart on this panel.
     * &lt;P&gt;
     * At the time the chart is drawn on the panel, if the available height is
     * greater than this amount, the chart will be drawn using the maximum
     * height then scaled up to fit the available space.
     *
     * @param height  The height.
     */
    public void setMaximumDrawHeight(int height) {
<span class="nc" id="L916">        this.maximumDrawHeight = height;</span>
<span class="nc" id="L917">    }</span>

    /**
     * Returns the X scale factor for the chart.  This will be 1.0 if no
     * scaling has been used.
     *
     * @return The scale factor.
     */
    public double getScaleX() {
<span class="nc" id="L926">        return this.scaleX;</span>
    }

    /**
     * Returns the Y scale factory for the chart.  This will be 1.0 if no
     * scaling has been used.
     *
     * @return The scale factor.
     */
    public double getScaleY() {
<span class="nc" id="L936">        return this.scaleY;</span>
    }

    /**
     * Returns the anchor point.
     *
     * @return The anchor point (possibly &lt;code&gt;null&lt;/code&gt;).
     */
    public Point2D getAnchor() {
<span class="nc" id="L945">        return this.anchor;</span>
    }

    /**
     * Sets the anchor point.  This method is provided for the use of
     * subclasses, not end users.
     *
     * @param anchor  the anchor point (&lt;code&gt;null&lt;/code&gt; permitted).
     */
    protected void setAnchor(Point2D anchor) {
<span class="nc" id="L955">        this.anchor = anchor;</span>
<span class="nc" id="L956">    }</span>

    /**
     * Returns the popup menu.
     *
     * @return The popup menu.
     */
    public JPopupMenu getPopupMenu() {
<span class="nc" id="L964">        return this.popup;</span>
    }

    /**
     * Sets the popup menu for the panel.
     *
     * @param popup  the popup menu (&lt;code&gt;null&lt;/code&gt; permitted).
     */
    public void setPopupMenu(JPopupMenu popup) {
<span class="nc" id="L973">        this.popup = popup;</span>
<span class="nc" id="L974">    }</span>

    /**
     * Returns the chart rendering info from the most recent chart redraw.
     *
     * @return The chart rendering info.
     */
    public ChartRenderingInfo getChartRenderingInfo() {
<span class="nc" id="L982">        return this.info;</span>
    }

    /**
     * A convenience method that switches on mouse-based zooming.
     *
     * @param flag  &lt;code&gt;true&lt;/code&gt; enables zooming and rectangle fill on
     *              zoom.
     */
    public void setMouseZoomable(boolean flag) {
<span class="nc" id="L992">        setMouseZoomable(flag, true);</span>
<span class="nc" id="L993">    }</span>

    /**
     * A convenience method that switches on mouse-based zooming.
     *
     * @param flag  &lt;code&gt;true&lt;/code&gt; if zooming enabled
     * @param fillRectangle  &lt;code&gt;true&lt;/code&gt; if zoom rectangle is filled,
     *                       false if rectangle is shown as outline only.
     */
    public void setMouseZoomable(boolean flag, boolean fillRectangle) {
<span class="nc" id="L1003">        setDomainZoomable(flag);</span>
<span class="nc" id="L1004">        setRangeZoomable(flag);</span>
<span class="nc" id="L1005">        setFillZoomRectangle(fillRectangle);</span>
<span class="nc" id="L1006">    }</span>

    /**
     * Returns the flag that determines whether or not zooming is enabled for
     * the domain axis.
     *
     * @return A boolean.
     */
    public boolean isDomainZoomable() {
<span class="nc" id="L1015">        return this.domainZoomable;</span>
    }

    /**
     * Sets the flag that controls whether or not zooming is enabled for the
     * domain axis.  A check is made to ensure that the current plot supports
     * zooming for the domain values.
     *
     * @param flag  &lt;code&gt;true&lt;/code&gt; enables zooming if possible.
     */
    public void setDomainZoomable(boolean flag) {
<span class="nc bnc" id="L1026" title="All 2 branches missed.">        if (flag) {</span>
<span class="nc" id="L1027">            Plot plot = this.chart.getPlot();</span>
<span class="nc bnc" id="L1028" title="All 2 branches missed.">            if (plot instanceof Zoomable) {</span>
<span class="nc" id="L1029">                Zoomable z = (Zoomable) plot;</span>
<span class="nc bnc" id="L1030" title="All 4 branches missed.">                this.domainZoomable = flag &amp;&amp; (z.isDomainZoomable());</span>
            }
<span class="nc" id="L1032">        }</span>
        else {
<span class="nc" id="L1034">            this.domainZoomable = false;</span>
        }
<span class="nc" id="L1036">    }</span>

    /**
     * Returns the flag that determines whether or not zooming is enabled for
     * the range axis.
     *
     * @return A boolean.
     */
    public boolean isRangeZoomable() {
<span class="nc" id="L1045">        return this.rangeZoomable;</span>
    }

    /**
     * A flag that controls mouse-based zooming on the vertical axis.
     *
     * @param flag  &lt;code&gt;true&lt;/code&gt; enables zooming.
     */
    public void setRangeZoomable(boolean flag) {
<span class="nc bnc" id="L1054" title="All 2 branches missed.">        if (flag) {</span>
<span class="nc" id="L1055">            Plot plot = this.chart.getPlot();</span>
<span class="nc bnc" id="L1056" title="All 2 branches missed.">            if (plot instanceof Zoomable) {</span>
<span class="nc" id="L1057">                Zoomable z = (Zoomable) plot;</span>
<span class="nc bnc" id="L1058" title="All 4 branches missed.">                this.rangeZoomable = flag &amp;&amp; (z.isRangeZoomable());</span>
            }
<span class="nc" id="L1060">        }</span>
        else {
<span class="nc" id="L1062">            this.rangeZoomable = false;</span>
        }
<span class="nc" id="L1064">    }</span>

    /**
     * Returns the flag that controls whether or not the zoom rectangle is
     * filled when drawn.
     *
     * @return A boolean.
     */
    public boolean getFillZoomRectangle() {
<span class="nc" id="L1073">        return this.fillZoomRectangle;</span>
    }

    /**
     * A flag that controls how the zoom rectangle is drawn.
     *
     * @param flag  &lt;code&gt;true&lt;/code&gt; instructs to fill the rectangle on
     *              zoom, otherwise it will be outlined.
     */
    public void setFillZoomRectangle(boolean flag) {
<span class="nc" id="L1083">        this.fillZoomRectangle = flag;</span>
<span class="nc" id="L1084">    }</span>

    /**
     * Returns the zoom trigger distance.  This controls how far the mouse must
     * move before a zoom action is triggered.
     *
     * @return The distance (in Java2D units).
     */
    public int getZoomTriggerDistance() {
<span class="nc" id="L1093">        return this.zoomTriggerDistance;</span>
    }

    /**
     * Sets the zoom trigger distance.  This controls how far the mouse must
     * move before a zoom action is triggered.
     *
     * @param distance  the distance (in Java2D units).
     */
    public void setZoomTriggerDistance(int distance) {
<span class="nc" id="L1103">        this.zoomTriggerDistance = distance;</span>
<span class="nc" id="L1104">    }</span>

    /**
     * Returns the flag that controls whether or not a horizontal axis trace
     * line is drawn over the plot area at the current mouse location.
     *
     * @return A boolean.
     */
    public boolean getHorizontalAxisTrace() {
<span class="nc" id="L1113">        return this.horizontalAxisTrace;</span>
    }

    /**
     * A flag that controls trace lines on the horizontal axis.
     *
     * @param flag  &lt;code&gt;true&lt;/code&gt; enables trace lines for the mouse
     *      pointer on the horizontal axis.
     */
    public void setHorizontalAxisTrace(boolean flag) {
<span class="nc" id="L1123">        this.horizontalAxisTrace = flag;</span>
<span class="nc" id="L1124">    }</span>

    /**
     * Returns the horizontal trace line.
     *
     * @return The horizontal trace line (possibly &lt;code&gt;null&lt;/code&gt;).
     */
    protected Line2D getHorizontalTraceLine() {
<span class="nc" id="L1132">        return this.horizontalTraceLine;</span>
    }

    /**
     * Sets the horizontal trace line.
     *
     * @param line  the line (&lt;code&gt;null&lt;/code&gt; permitted).
     */
    protected void setHorizontalTraceLine(Line2D line) {
<span class="nc" id="L1141">        this.horizontalTraceLine = line;</span>
<span class="nc" id="L1142">    }</span>

    /**
     * Returns the flag that controls whether or not a vertical axis trace
     * line is drawn over the plot area at the current mouse location.
     *
     * @return A boolean.
     */
    public boolean getVerticalAxisTrace() {
<span class="nc" id="L1151">        return this.verticalAxisTrace;</span>
    }

    /**
     * A flag that controls trace lines on the vertical axis.
     *
     * @param flag  &lt;code&gt;true&lt;/code&gt; enables trace lines for the mouse
     *              pointer on the vertical axis.
     */
    public void setVerticalAxisTrace(boolean flag) {
<span class="nc" id="L1161">        this.verticalAxisTrace = flag;</span>
<span class="nc" id="L1162">    }</span>

    /**
     * Returns the vertical trace line.
     *
     * @return The vertical trace line (possibly &lt;code&gt;null&lt;/code&gt;).
     */
    protected Line2D getVerticalTraceLine() {
<span class="nc" id="L1170">        return this.verticalTraceLine;</span>
    }

    /**
     * Sets the vertical trace line.
     *
     * @param line  the line (&lt;code&gt;null&lt;/code&gt; permitted).
     */
    protected void setVerticalTraceLine(Line2D line) {
<span class="nc" id="L1179">        this.verticalTraceLine = line;</span>
<span class="nc" id="L1180">    }</span>

    /**
     * Returns the default directory for the &quot;save as&quot; option.
     *
     * @return The default directory (possibly &lt;code&gt;null&lt;/code&gt;).
     *
     * @since 1.0.7
     */
    public File getDefaultDirectoryForSaveAs() {
<span class="nc" id="L1190">        return this.defaultDirectoryForSaveAs;</span>
    }

    /**
     * Sets the default directory for the &quot;save as&quot; option.  If you set this
     * to &lt;code&gt;null&lt;/code&gt;, the user's default directory will be used.
     *
     * @param directory  the directory (&lt;code&gt;null&lt;/code&gt; permitted).
     *
     * @since 1.0.7
     */
    public void setDefaultDirectoryForSaveAs(File directory) {
<span class="nc bnc" id="L1202" title="All 2 branches missed.">        if (directory != null) {</span>
<span class="nc bnc" id="L1203" title="All 2 branches missed.">            if (!directory.isDirectory()) {</span>
<span class="nc" id="L1204">                throw new IllegalArgumentException(</span>
<span class="nc" id="L1205">                        &quot;The 'directory' argument is not a directory.&quot;);</span>
            }
        }
<span class="nc" id="L1208">        this.defaultDirectoryForSaveAs = directory;</span>
<span class="nc" id="L1209">    }</span>

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if file extensions should be enforced, and
     * &lt;code&gt;false&lt;/code&gt; otherwise.
     *
     * @return The flag.
     *
     * @see #setEnforceFileExtensions(boolean)
     */
    public boolean isEnforceFileExtensions() {
<span class="nc" id="L1220">        return this.enforceFileExtensions;</span>
    }

    /**
     * Sets a flag that controls whether or not file extensions are enforced.
     *
     * @param enforce  the new flag value.
     *
     * @see #isEnforceFileExtensions()
     */
    public void setEnforceFileExtensions(boolean enforce) {
<span class="nc" id="L1231">        this.enforceFileExtensions = enforce;</span>
<span class="nc" id="L1232">    }</span>

    /**
     * Returns the flag that controls whether or not zoom operations are
     * centered around the current anchor point.
     *
     * @return A boolean.
     *
     * @since 1.0.7
     *
     * @see #setZoomAroundAnchor(boolean)
     */
    public boolean getZoomAroundAnchor() {
<span class="nc" id="L1245">        return this.zoomAroundAnchor;</span>
    }

    /**
     * Sets the flag that controls whether or not zoom operations are
     * centered around the current anchor point.
     *
     * @param zoomAroundAnchor  the new flag value.
     *
     * @since 1.0.7
     *
     * @see #getZoomAroundAnchor()
     */
    public void setZoomAroundAnchor(boolean zoomAroundAnchor) {
<span class="nc" id="L1259">        this.zoomAroundAnchor = zoomAroundAnchor;</span>
<span class="nc" id="L1260">    }</span>

    /**
     * Returns the zoom rectangle fill paint.
     *
     * @return The zoom rectangle fill paint (never &lt;code&gt;null&lt;/code&gt;).
     *
     * @see #setZoomFillPaint(java.awt.Paint)
     * @see #setFillZoomRectangle(boolean)
     *
     * @since 1.0.13
     */
    public Paint getZoomFillPaint() {
<span class="nc" id="L1273">        return this.zoomFillPaint;</span>
    }

    /**
     * Sets the zoom rectangle fill paint.
     *
     * @param paint  the paint (&lt;code&gt;null&lt;/code&gt; not permitted).
     *
     * @see #getZoomFillPaint()
     * @see #getFillZoomRectangle()
     *
     * @since 1.0.13
     */
    public void setZoomFillPaint(Paint paint) {
<span class="nc" id="L1287">        ParamChecks.nullNotPermitted(paint, &quot;paint&quot;);</span>
<span class="nc" id="L1288">        this.zoomFillPaint = paint;</span>
<span class="nc" id="L1289">    }</span>

    /**
     * Returns the zoom rectangle outline paint.
     *
     * @return The zoom rectangle outline paint (never &lt;code&gt;null&lt;/code&gt;).
     *
     * @see #setZoomOutlinePaint(java.awt.Paint)
     * @see #setFillZoomRectangle(boolean)
     *
     * @since 1.0.13
     */
    public Paint getZoomOutlinePaint() {
<span class="nc" id="L1302">        return this.zoomOutlinePaint;</span>
    }

    /**
     * Sets the zoom rectangle outline paint.
     *
     * @param paint  the paint (&lt;code&gt;null&lt;/code&gt; not permitted).
     *
     * @see #getZoomOutlinePaint()
     * @see #getFillZoomRectangle()
     *
     * @since 1.0.13
     */
    public void setZoomOutlinePaint(Paint paint) {
<span class="nc" id="L1316">        this.zoomOutlinePaint = paint;</span>
<span class="nc" id="L1317">    }</span>

    /**
     * The mouse wheel handler.
     */
    private MouseWheelHandler mouseWheelHandler;

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if the mouse wheel handler is enabled, and
     * &lt;code&gt;false&lt;/code&gt; otherwise.
     *
     * @return A boolean.
     *
     * @since 1.0.13
     */
    public boolean isMouseWheelEnabled() {
<span class="nc bnc" id="L1333" title="All 2 branches missed.">        return this.mouseWheelHandler != null;</span>
    }

    /**
     * Enables or disables mouse wheel support for the panel.
     *
     * @param flag  a boolean.
     *
     * @since 1.0.13
     */
    public void setMouseWheelEnabled(boolean flag) {
<span class="nc bnc" id="L1344" title="All 4 branches missed.">        if (flag &amp;&amp; this.mouseWheelHandler == null) {</span>
<span class="nc" id="L1345">            this.mouseWheelHandler = new MouseWheelHandler(this);</span>
<span class="nc" id="L1346">        }</span>
<span class="nc bnc" id="L1347" title="All 4 branches missed.">        else if (!flag &amp;&amp; this.mouseWheelHandler != null) {</span>
<span class="nc" id="L1348">            this.removeMouseWheelListener(this.mouseWheelHandler);</span>
<span class="nc" id="L1349">            this.mouseWheelHandler = null;</span>
        } 
<span class="nc" id="L1351">    }</span>

    /**
     * Add an overlay to the panel.
     *
     * @param overlay  the overlay (&lt;code&gt;null&lt;/code&gt; not permitted).
     *
     * @since 1.0.13
     */
    public void addOverlay(Overlay overlay) {
<span class="nc" id="L1361">        ParamChecks.nullNotPermitted(overlay, &quot;overlay&quot;);</span>
<span class="nc" id="L1362">        this.overlays.add(overlay);</span>
<span class="nc" id="L1363">        overlay.addChangeListener(this);</span>
<span class="nc" id="L1364">        repaint();</span>
<span class="nc" id="L1365">    }</span>

    /**
     * Removes an overlay from the panel.
     *
     * @param overlay  the overlay to remove (&lt;code&gt;null&lt;/code&gt; not permitted).
     *
     * @since 1.0.13
     */
    public void removeOverlay(Overlay overlay) {
<span class="nc" id="L1375">        ParamChecks.nullNotPermitted(overlay, &quot;overlay&quot;);</span>
<span class="nc" id="L1376">        boolean removed = this.overlays.remove(overlay);</span>
<span class="nc bnc" id="L1377" title="All 2 branches missed.">        if (removed) {</span>
<span class="nc" id="L1378">            overlay.removeChangeListener(this);</span>
<span class="nc" id="L1379">            repaint();</span>
        }
<span class="nc" id="L1381">    }</span>

    /**
     * Handles a change to an overlay by repainting the panel.
     *
     * @param event  the event.
     *
     * @since 1.0.13
     */
    @Override
    public void overlayChanged(OverlayChangeEvent event) {
<span class="nc" id="L1392">        repaint();</span>
<span class="nc" id="L1393">    }</span>

    /**
     * Switches the display of tooltips for the panel on or off.  Note that
     * tooltips can only be displayed if the chart has been configured to
     * generate tooltip items.
     *
     * @param flag  &lt;code&gt;true&lt;/code&gt; to enable tooltips, &lt;code&gt;false&lt;/code&gt; to
     *              disable tooltips.
     */
    public void setDisplayToolTips(boolean flag) {
<span class="nc bnc" id="L1404" title="All 2 branches missed.">        if (flag) {</span>
<span class="nc" id="L1405">            ToolTipManager.sharedInstance().registerComponent(this);</span>
<span class="nc" id="L1406">        }</span>
        else {
<span class="nc" id="L1408">            ToolTipManager.sharedInstance().unregisterComponent(this);</span>
        }
<span class="nc" id="L1410">    }</span>

    /**
     * Returns a string for the tooltip.
     *
     * @param e  the mouse event.
     *
     * @return A tool tip or &lt;code&gt;null&lt;/code&gt; if no tooltip is available.
     */
    @Override
    public String getToolTipText(MouseEvent e) {
<span class="nc" id="L1421">        String result = null;</span>
<span class="nc bnc" id="L1422" title="All 2 branches missed.">        if (this.info != null) {</span>
<span class="nc" id="L1423">            EntityCollection entities = this.info.getEntityCollection();</span>
<span class="nc bnc" id="L1424" title="All 2 branches missed.">            if (entities != null) {</span>
<span class="nc" id="L1425">                Insets insets = getInsets();</span>
<span class="nc" id="L1426">                ChartEntity entity = entities.getEntity(</span>
<span class="nc" id="L1427">                        (int) ((e.getX() - insets.left) / this.scaleX),</span>
<span class="nc" id="L1428">                        (int) ((e.getY() - insets.top) / this.scaleY));</span>
<span class="nc bnc" id="L1429" title="All 2 branches missed.">                if (entity != null) {</span>
<span class="nc" id="L1430">                    result = entity.getToolTipText();</span>
                }
            }
        }
<span class="nc" id="L1434">        return result;</span>
    }

    /**
     * Translates a Java2D point on the chart to a screen location.
     *
     * @param java2DPoint  the Java2D point.
     *
     * @return The screen location.
     */
    public Point translateJava2DToScreen(Point2D java2DPoint) {
<span class="nc" id="L1445">        Insets insets = getInsets();</span>
<span class="nc" id="L1446">        int x = (int) (java2DPoint.getX() * this.scaleX + insets.left);</span>
<span class="nc" id="L1447">        int y = (int) (java2DPoint.getY() * this.scaleY + insets.top);</span>
<span class="nc" id="L1448">        return new Point(x, y);</span>
    }

    /**
     * Translates a panel (component) location to a Java2D point.
     *
     * @param screenPoint  the screen location (&lt;code&gt;null&lt;/code&gt; not
     *                     permitted).
     *
     * @return The Java2D coordinates.
     */
    public Point2D translateScreenToJava2D(Point screenPoint) {
<span class="nc" id="L1460">        Insets insets = getInsets();</span>
<span class="nc" id="L1461">        double x = (screenPoint.getX() - insets.left) / this.scaleX;</span>
<span class="nc" id="L1462">        double y = (screenPoint.getY() - insets.top) / this.scaleY;</span>
<span class="nc" id="L1463">        return new Point2D.Double(x, y);</span>
    }

    /**
     * Applies any scaling that is in effect for the chart drawing to the
     * given rectangle.
     *
     * @param rect  the rectangle (&lt;code&gt;null&lt;/code&gt; not permitted).
     *
     * @return A new scaled rectangle.
     */
    public Rectangle2D scale(Rectangle2D rect) {
<span class="nc" id="L1475">        Insets insets = getInsets();</span>
<span class="nc" id="L1476">        double x = rect.getX() * getScaleX() + insets.left;</span>
<span class="nc" id="L1477">        double y = rect.getY() * getScaleY() + insets.top;</span>
<span class="nc" id="L1478">        double w = rect.getWidth() * getScaleX();</span>
<span class="nc" id="L1479">        double h = rect.getHeight() * getScaleY();</span>
<span class="nc" id="L1480">        return new Rectangle2D.Double(x, y, w, h);</span>
    }

    /**
     * Returns the chart entity at a given point.
     * &lt;P&gt;
     * This method will return null if there is (a) no entity at the given
     * point, or (b) no entity collection has been generated.
     *
     * @param viewX  the x-coordinate.
     * @param viewY  the y-coordinate.
     *
     * @return The chart entity (possibly &lt;code&gt;null&lt;/code&gt;).
     */
    public ChartEntity getEntityForPoint(int viewX, int viewY) {

<span class="nc" id="L1496">        ChartEntity result = null;</span>
<span class="nc bnc" id="L1497" title="All 2 branches missed.">        if (this.info != null) {</span>
<span class="nc" id="L1498">            Insets insets = getInsets();</span>
<span class="nc" id="L1499">            double x = (viewX - insets.left) / this.scaleX;</span>
<span class="nc" id="L1500">            double y = (viewY - insets.top) / this.scaleY;</span>
<span class="nc" id="L1501">            EntityCollection entities = this.info.getEntityCollection();</span>
<span class="nc bnc" id="L1502" title="All 2 branches missed.">            result = entities != null ? entities.getEntity(x, y) : null;</span>
        }
<span class="nc" id="L1504">        return result;</span>

    }

    /**
     * Returns the flag that controls whether or not the offscreen buffer
     * needs to be refreshed.
     *
     * @return A boolean.
     */
    public boolean getRefreshBuffer() {
<span class="nc" id="L1515">        return this.refreshBuffer;</span>
    }

    /**
     * Sets the refresh buffer flag.  This flag is used to avoid unnecessary
     * redrawing of the chart when the offscreen image buffer is used.
     *
     * @param flag  &lt;code&gt;true&lt;/code&gt; indicates that the buffer should be
     *              refreshed.
     */
    public void setRefreshBuffer(boolean flag) {
<span class="nc" id="L1526">        this.refreshBuffer = flag;</span>
<span class="nc" id="L1527">    }</span>

    /**
     * Paints the component by drawing the chart to fill the entire component,
     * but allowing for the insets (which will be non-zero if a border has been
     * set for this component).  To increase performance (at the expense of
     * memory), an off-screen buffer image can be used.
     *
     * @param g  the graphics device for drawing on.
     */
    @Override
    public void paintComponent(Graphics g) {
<span class="nc" id="L1539">        super.paintComponent(g);</span>
<span class="nc bnc" id="L1540" title="All 2 branches missed.">        if (this.chart == null) {</span>
<span class="nc" id="L1541">            return;</span>
        }
<span class="nc" id="L1543">        Graphics2D g2 = (Graphics2D) g.create();</span>
        
        // first determine the size of the chart rendering area...
<span class="nc" id="L1546">        Dimension size = getSize();</span>
<span class="nc" id="L1547">        Insets insets = getInsets();</span>
<span class="nc" id="L1548">        Rectangle2D available = new Rectangle2D.Double(insets.left, insets.top,</span>
<span class="nc" id="L1549">                size.getWidth() - insets.left - insets.right,</span>
<span class="nc" id="L1550">                size.getHeight() - insets.top - insets.bottom);</span>

        // work out if scaling is required...
<span class="nc" id="L1553">        boolean scale = false;</span>
<span class="nc" id="L1554">        double drawWidth = available.getWidth();</span>
<span class="nc" id="L1555">        double drawHeight = available.getHeight();</span>
<span class="nc" id="L1556">        this.scaleX = 1.0;</span>
<span class="nc" id="L1557">        this.scaleY = 1.0;</span>

<span class="nc bnc" id="L1559" title="All 2 branches missed.">        if (drawWidth &lt; this.minimumDrawWidth) {</span>
<span class="nc" id="L1560">            this.scaleX = drawWidth / this.minimumDrawWidth;</span>
<span class="nc" id="L1561">            drawWidth = this.minimumDrawWidth;</span>
<span class="nc" id="L1562">            scale = true;</span>
<span class="nc" id="L1563">        }</span>
<span class="nc bnc" id="L1564" title="All 2 branches missed.">        else if (drawWidth &gt; this.maximumDrawWidth) {</span>
<span class="nc" id="L1565">            this.scaleX = drawWidth / this.maximumDrawWidth;</span>
<span class="nc" id="L1566">            drawWidth = this.maximumDrawWidth;</span>
<span class="nc" id="L1567">            scale = true;</span>
        }

<span class="nc bnc" id="L1570" title="All 2 branches missed.">        if (drawHeight &lt; this.minimumDrawHeight) {</span>
<span class="nc" id="L1571">            this.scaleY = drawHeight / this.minimumDrawHeight;</span>
<span class="nc" id="L1572">            drawHeight = this.minimumDrawHeight;</span>
<span class="nc" id="L1573">            scale = true;</span>
<span class="nc" id="L1574">        }</span>
<span class="nc bnc" id="L1575" title="All 2 branches missed.">        else if (drawHeight &gt; this.maximumDrawHeight) {</span>
<span class="nc" id="L1576">            this.scaleY = drawHeight / this.maximumDrawHeight;</span>
<span class="nc" id="L1577">            drawHeight = this.maximumDrawHeight;</span>
<span class="nc" id="L1578">            scale = true;</span>
        }

<span class="nc" id="L1581">        Rectangle2D chartArea = new Rectangle2D.Double(0.0, 0.0, drawWidth,</span>
<span class="nc" id="L1582">                drawHeight);</span>

        // are we using the chart buffer?
<span class="nc bnc" id="L1585" title="All 2 branches missed.">        if (this.useBuffer) {</span>

            // do we need to resize the buffer?
<span class="nc bnc" id="L1588" title="All 2 branches missed.">            if ((this.chartBuffer == null)</span>
<span class="nc bnc" id="L1589" title="All 2 branches missed.">                    || (this.chartBufferWidth != available.getWidth())</span>
<span class="nc bnc" id="L1590" title="All 2 branches missed.">                    || (this.chartBufferHeight != available.getHeight())) {</span>
<span class="nc" id="L1591">                this.chartBufferWidth = (int) available.getWidth();</span>
<span class="nc" id="L1592">                this.chartBufferHeight = (int) available.getHeight();</span>
<span class="nc" id="L1593">                GraphicsConfiguration gc = g2.getDeviceConfiguration();</span>
<span class="nc" id="L1594">                this.chartBuffer = gc.createCompatibleImage(</span>
<span class="nc" id="L1595">                        this.chartBufferWidth, this.chartBufferHeight,</span>
<span class="nc" id="L1596">                        Transparency.TRANSLUCENT);</span>
<span class="nc" id="L1597">                this.refreshBuffer = true;</span>
            }

            // do we need to redraw the buffer?
<span class="nc bnc" id="L1601" title="All 2 branches missed.">            if (this.refreshBuffer) {</span>

<span class="nc" id="L1603">                this.refreshBuffer = false; // clear the flag</span>

<span class="nc" id="L1605">                Rectangle2D bufferArea = new Rectangle2D.Double(</span>
<span class="nc" id="L1606">                        0, 0, this.chartBufferWidth, this.chartBufferHeight);</span>

                // make the background of the buffer clear and transparent
<span class="nc" id="L1609">                Graphics2D bufferG2 = (Graphics2D)</span>
<span class="nc" id="L1610">                        this.chartBuffer.getGraphics();</span>
<span class="nc" id="L1611">                Composite savedComposite = bufferG2.getComposite();</span>
<span class="nc" id="L1612">                bufferG2.setComposite(AlphaComposite.getInstance(</span>
<span class="nc" id="L1613">                        AlphaComposite.CLEAR, 0.0f));</span>
<span class="nc" id="L1614">                Rectangle r = new Rectangle(0, 0, this.chartBufferWidth,</span>
<span class="nc" id="L1615">                        this.chartBufferHeight);</span>
<span class="nc" id="L1616">                bufferG2.fill(r);</span>
<span class="nc" id="L1617">                bufferG2.setComposite(savedComposite);</span>
                
<span class="nc bnc" id="L1619" title="All 2 branches missed.">                if (scale) {</span>
<span class="nc" id="L1620">                    AffineTransform saved = bufferG2.getTransform();</span>
<span class="nc" id="L1621">                    AffineTransform st = AffineTransform.getScaleInstance(</span>
<span class="nc" id="L1622">                            this.scaleX, this.scaleY);</span>
<span class="nc" id="L1623">                    bufferG2.transform(st);</span>
<span class="nc" id="L1624">                    this.chart.draw(bufferG2, chartArea, this.anchor,</span>
<span class="nc" id="L1625">                            this.info);</span>
<span class="nc" id="L1626">                    bufferG2.setTransform(saved);</span>
<span class="nc" id="L1627">                } else {</span>
<span class="nc" id="L1628">                    this.chart.draw(bufferG2, bufferArea, this.anchor,</span>
<span class="nc" id="L1629">                            this.info);</span>
                }

            }

            // zap the buffer onto the panel...
<span class="nc" id="L1635">            g2.drawImage(this.chartBuffer, insets.left, insets.top, this);</span>

<span class="nc" id="L1637">        } else { // redrawing the chart every time...</span>
<span class="nc" id="L1638">            AffineTransform saved = g2.getTransform();</span>
<span class="nc" id="L1639">            g2.translate(insets.left, insets.top);</span>
<span class="nc bnc" id="L1640" title="All 2 branches missed.">            if (scale) {</span>
<span class="nc" id="L1641">                AffineTransform st = AffineTransform.getScaleInstance(</span>
<span class="nc" id="L1642">                        this.scaleX, this.scaleY);</span>
<span class="nc" id="L1643">                g2.transform(st);</span>
            }
<span class="nc" id="L1645">            this.chart.draw(g2, chartArea, this.anchor, this.info);</span>
<span class="nc" id="L1646">            g2.setTransform(saved);</span>

        }

<span class="nc" id="L1650">        Iterator iterator = this.overlays.iterator();</span>
<span class="nc bnc" id="L1651" title="All 2 branches missed.">        while (iterator.hasNext()) {</span>
<span class="nc" id="L1652">            Overlay overlay = (Overlay) iterator.next();</span>
<span class="nc" id="L1653">            overlay.paintOverlay(g2, this);</span>
        }

        // redraw the zoom rectangle (if present) - if useBuffer is false,
        // we use XOR so we can XOR the rectangle away again without redrawing
        // the chart
<span class="nc bnc" id="L1659" title="All 2 branches missed.">        drawZoomRectangle(g2, !this.useBuffer);</span>

<span class="nc" id="L1661">        g2.dispose();</span>

<span class="nc" id="L1663">        this.anchor = null;</span>
<span class="nc" id="L1664">        this.verticalTraceLine = null;</span>
<span class="nc" id="L1665">        this.horizontalTraceLine = null;</span>
<span class="nc" id="L1666">    }</span>

    /**
     * Receives notification of changes to the chart, and redraws the chart.
     *
     * @param event  details of the chart change event.
     */
    @Override
    public void chartChanged(ChartChangeEvent event) {
<span class="nc" id="L1675">        this.refreshBuffer = true;</span>
<span class="nc" id="L1676">        Plot plot = this.chart.getPlot();</span>
<span class="nc bnc" id="L1677" title="All 2 branches missed.">        if (plot instanceof Zoomable) {</span>
<span class="nc" id="L1678">            Zoomable z = (Zoomable) plot;</span>
<span class="nc" id="L1679">            this.orientation = z.getOrientation();</span>
        }
<span class="nc" id="L1681">        repaint();</span>
<span class="nc" id="L1682">    }</span>

    /**
     * Receives notification of a chart progress event.
     *
     * @param event  the event.
     */
    @Override
    public void chartProgress(ChartProgressEvent event) {
        // does nothing - override if necessary
<span class="nc" id="L1692">    }</span>

    /**
     * Handles action events generated by the popup menu.
     *
     * @param event  the event.
     */
    @Override
    public void actionPerformed(ActionEvent event) {

<span class="nc" id="L1702">        String command = event.getActionCommand();</span>

        // many of the zoom methods need a screen location - all we have is
        // the zoomPoint, but it might be null.  Here we grab the x and y
        // coordinates, or use defaults...
<span class="nc" id="L1707">        double screenX = -1.0;</span>
<span class="nc" id="L1708">        double screenY = -1.0;</span>
<span class="nc bnc" id="L1709" title="All 2 branches missed.">        if (this.zoomPoint != null) {</span>
<span class="nc" id="L1710">            screenX = this.zoomPoint.getX();</span>
<span class="nc" id="L1711">            screenY = this.zoomPoint.getY();</span>
        }

<span class="nc bnc" id="L1714" title="All 2 branches missed.">        if (command.equals(PROPERTIES_COMMAND)) {</span>
<span class="nc" id="L1715">            doEditChartProperties();</span>
<span class="nc" id="L1716">        }</span>
<span class="nc bnc" id="L1717" title="All 2 branches missed.">        else if (command.equals(COPY_COMMAND)) {</span>
<span class="nc" id="L1718">            doCopy();</span>
<span class="nc" id="L1719">        }</span>
<span class="nc bnc" id="L1720" title="All 2 branches missed.">        else if (command.equals(SAVE_AS_PNG_COMMAND)) {</span>
            try {
<span class="nc" id="L1722">                doSaveAs();</span>
<span class="nc" id="L1723">            }</span>
<span class="nc" id="L1724">            catch (IOException e) {</span>
<span class="nc" id="L1725">                JOptionPane.showMessageDialog(this, &quot;I/O error occurred.&quot;, </span>
<span class="nc" id="L1726">                        &quot;Save As PNG&quot;, JOptionPane.WARNING_MESSAGE);</span>
            }
<span class="nc" id="L1728">        }</span>
<span class="nc bnc" id="L1729" title="All 2 branches missed.">        else if (command.equals(SAVE_AS_SVG_COMMAND)) {</span>
            try {
<span class="nc" id="L1731">                saveAsSVG(null);</span>
<span class="nc" id="L1732">            } catch (IOException e) {</span>
<span class="nc" id="L1733">                JOptionPane.showMessageDialog(this, &quot;I/O error occurred.&quot;, </span>
<span class="nc" id="L1734">                        &quot;Save As SVG&quot;, JOptionPane.WARNING_MESSAGE);</span>
            }
<span class="nc" id="L1736">        }</span>
<span class="nc bnc" id="L1737" title="All 2 branches missed.">        else if (command.equals(SAVE_AS_PDF_COMMAND)) {</span>
<span class="nc" id="L1738">            saveAsPDF(null);</span>
<span class="nc" id="L1739">        }</span>
<span class="nc bnc" id="L1740" title="All 2 branches missed.">        else if (command.equals(PRINT_COMMAND)) {</span>
<span class="nc" id="L1741">            createChartPrintJob();</span>
<span class="nc" id="L1742">        }</span>
<span class="nc bnc" id="L1743" title="All 2 branches missed.">        else if (command.equals(ZOOM_IN_BOTH_COMMAND)) {</span>
<span class="nc" id="L1744">            zoomInBoth(screenX, screenY);</span>
<span class="nc" id="L1745">        }</span>
<span class="nc bnc" id="L1746" title="All 2 branches missed.">        else if (command.equals(ZOOM_IN_DOMAIN_COMMAND)) {</span>
<span class="nc" id="L1747">            zoomInDomain(screenX, screenY);</span>
<span class="nc" id="L1748">        }</span>
<span class="nc bnc" id="L1749" title="All 2 branches missed.">        else if (command.equals(ZOOM_IN_RANGE_COMMAND)) {</span>
<span class="nc" id="L1750">            zoomInRange(screenX, screenY);</span>
<span class="nc" id="L1751">        }</span>
<span class="nc bnc" id="L1752" title="All 2 branches missed.">        else if (command.equals(ZOOM_OUT_BOTH_COMMAND)) {</span>
<span class="nc" id="L1753">            zoomOutBoth(screenX, screenY);</span>
<span class="nc" id="L1754">        }</span>
<span class="nc bnc" id="L1755" title="All 2 branches missed.">        else if (command.equals(ZOOM_OUT_DOMAIN_COMMAND)) {</span>
<span class="nc" id="L1756">            zoomOutDomain(screenX, screenY);</span>
<span class="nc" id="L1757">        }</span>
<span class="nc bnc" id="L1758" title="All 2 branches missed.">        else if (command.equals(ZOOM_OUT_RANGE_COMMAND)) {</span>
<span class="nc" id="L1759">            zoomOutRange(screenX, screenY);</span>
<span class="nc" id="L1760">        }</span>
<span class="nc bnc" id="L1761" title="All 2 branches missed.">        else if (command.equals(ZOOM_RESET_BOTH_COMMAND)) {</span>
<span class="nc" id="L1762">            restoreAutoBounds();</span>
<span class="nc" id="L1763">        }</span>
<span class="nc bnc" id="L1764" title="All 2 branches missed.">        else if (command.equals(ZOOM_RESET_DOMAIN_COMMAND)) {</span>
<span class="nc" id="L1765">            restoreAutoDomainBounds();</span>
<span class="nc" id="L1766">        }</span>
<span class="nc bnc" id="L1767" title="All 2 branches missed.">        else if (command.equals(ZOOM_RESET_RANGE_COMMAND)) {</span>
<span class="nc" id="L1768">            restoreAutoRangeBounds();</span>
        }

<span class="nc" id="L1771">    }</span>

    /**
     * Handles a 'mouse entered' event. This method changes the tooltip delays
     * of ToolTipManager.sharedInstance() to the possibly different values set
     * for this chart panel.
     *
     * @param e  the mouse event.
     */
    @Override
    public void mouseEntered(MouseEvent e) {
<span class="nc bnc" id="L1782" title="All 2 branches missed.">        if (!this.ownToolTipDelaysActive) {</span>
<span class="nc" id="L1783">            ToolTipManager ttm = ToolTipManager.sharedInstance();</span>

<span class="nc" id="L1785">            this.originalToolTipInitialDelay = ttm.getInitialDelay();</span>
<span class="nc" id="L1786">            ttm.setInitialDelay(this.ownToolTipInitialDelay);</span>

<span class="nc" id="L1788">            this.originalToolTipReshowDelay = ttm.getReshowDelay();</span>
<span class="nc" id="L1789">            ttm.setReshowDelay(this.ownToolTipReshowDelay);</span>

<span class="nc" id="L1791">            this.originalToolTipDismissDelay = ttm.getDismissDelay();</span>
<span class="nc" id="L1792">            ttm.setDismissDelay(this.ownToolTipDismissDelay);</span>

<span class="nc" id="L1794">            this.ownToolTipDelaysActive = true;</span>
        }
<span class="nc" id="L1796">    }</span>

    /**
     * Handles a 'mouse exited' event. This method resets the tooltip delays of
     * ToolTipManager.sharedInstance() to their
     * original values in effect before mouseEntered()
     *
     * @param e  the mouse event.
     */
    @Override
    public void mouseExited(MouseEvent e) {
<span class="nc bnc" id="L1807" title="All 2 branches missed.">        if (this.ownToolTipDelaysActive) {</span>
            // restore original tooltip dealys
<span class="nc" id="L1809">            ToolTipManager ttm = ToolTipManager.sharedInstance();</span>
<span class="nc" id="L1810">            ttm.setInitialDelay(this.originalToolTipInitialDelay);</span>
<span class="nc" id="L1811">            ttm.setReshowDelay(this.originalToolTipReshowDelay);</span>
<span class="nc" id="L1812">            ttm.setDismissDelay(this.originalToolTipDismissDelay);</span>
<span class="nc" id="L1813">            this.ownToolTipDelaysActive = false;</span>
        }
<span class="nc" id="L1815">    }</span>

    /**
     * Handles a 'mouse pressed' event.
     * &lt;P&gt;
     * This event is the popup trigger on Unix/Linux.  For Windows, the popup
     * trigger is the 'mouse released' event.
     *
     * @param e  The mouse event.
     */
    @Override
    public void mousePressed(MouseEvent e) {
<span class="nc bnc" id="L1827" title="All 2 branches missed.">        if (this.chart == null) {</span>
<span class="nc" id="L1828">            return;</span>
        }
<span class="nc" id="L1830">        Plot plot = this.chart.getPlot();</span>
<span class="nc" id="L1831">        int mods = e.getModifiers();</span>
<span class="nc bnc" id="L1832" title="All 2 branches missed.">        if ((mods &amp; this.panMask) == this.panMask) {</span>
            // can we pan this plot?
<span class="nc bnc" id="L1834" title="All 2 branches missed.">            if (plot instanceof Pannable) {</span>
<span class="nc" id="L1835">                Pannable pannable = (Pannable) plot;</span>
<span class="nc bnc" id="L1836" title="All 4 branches missed.">                if (pannable.isDomainPannable() || pannable.isRangePannable()) {</span>
<span class="nc" id="L1837">                    Rectangle2D screenDataArea = getScreenDataArea(e.getX(),</span>
<span class="nc" id="L1838">                            e.getY());</span>
<span class="nc bnc" id="L1839" title="All 2 branches missed.">                    if (screenDataArea != null &amp;&amp; screenDataArea.contains(</span>
<span class="nc bnc" id="L1840" title="All 2 branches missed.">                            e.getPoint())) {</span>
<span class="nc" id="L1841">                        this.panW = screenDataArea.getWidth();</span>
<span class="nc" id="L1842">                        this.panH = screenDataArea.getHeight();</span>
<span class="nc" id="L1843">                        this.panLast = e.getPoint();</span>
<span class="nc" id="L1844">                        setCursor(Cursor.getPredefinedCursor(</span>
<span class="nc" id="L1845">                                Cursor.MOVE_CURSOR));</span>
                    }
                }
                // the actual panning occurs later in the mouseDragged() 
                // method
            }
<span class="nc" id="L1851">        }</span>
<span class="nc bnc" id="L1852" title="All 2 branches missed.">        else if (this.zoomRectangle == null) {</span>
<span class="nc" id="L1853">            Rectangle2D screenDataArea = getScreenDataArea(e.getX(), e.getY());</span>
<span class="nc bnc" id="L1854" title="All 2 branches missed.">            if (screenDataArea != null) {</span>
<span class="nc" id="L1855">                this.zoomPoint = getPointInRectangle(e.getX(), e.getY(),</span>
<span class="nc" id="L1856">                        screenDataArea);</span>
<span class="nc" id="L1857">            }</span>
            else {
<span class="nc" id="L1859">                this.zoomPoint = null;</span>
            }
<span class="nc bnc" id="L1861" title="All 2 branches missed.">            if (e.isPopupTrigger()) {</span>
<span class="nc bnc" id="L1862" title="All 2 branches missed.">                if (this.popup != null) {</span>
<span class="nc" id="L1863">                    displayPopupMenu(e.getX(), e.getY());</span>
                }
            }
        }
<span class="nc" id="L1867">    }</span>

    /**
     * Returns a point based on (x, y) but constrained to be within the bounds
     * of the given rectangle.  This method could be moved to JCommon.
     *
     * @param x  the x-coordinate.
     * @param y  the y-coordinate.
     * @param area  the rectangle (&lt;code&gt;null&lt;/code&gt; not permitted).
     *
     * @return A point within the rectangle.
     */
    private Point2D getPointInRectangle(int x, int y, Rectangle2D area) {
<span class="nc" id="L1880">        double xx = Math.max(area.getMinX(), Math.min(x, area.getMaxX()));</span>
<span class="nc" id="L1881">        double yy = Math.max(area.getMinY(), Math.min(y, area.getMaxY()));</span>
<span class="nc" id="L1882">        return new Point2D.Double(xx, yy);</span>
    }

    /**
     * Handles a 'mouse dragged' event.
     *
     * @param e  the mouse event.
     */
    @Override
    public void mouseDragged(MouseEvent e) {

        // if the popup menu has already been triggered, then ignore dragging...
<span class="nc bnc" id="L1894" title="All 4 branches missed.">        if (this.popup != null &amp;&amp; this.popup.isShowing()) {</span>
<span class="nc" id="L1895">            return;</span>
        }

        // handle panning if we have a start point
<span class="nc bnc" id="L1899" title="All 2 branches missed.">        if (this.panLast != null) {</span>
<span class="nc" id="L1900">            double dx = e.getX() - this.panLast.getX();</span>
<span class="nc" id="L1901">            double dy = e.getY() - this.panLast.getY();</span>
<span class="nc bnc" id="L1902" title="All 4 branches missed.">            if (dx == 0.0 &amp;&amp; dy == 0.0) {</span>
<span class="nc" id="L1903">                return;</span>
            }
<span class="nc" id="L1905">            double wPercent = -dx / this.panW;</span>
<span class="nc" id="L1906">            double hPercent = dy / this.panH;</span>
<span class="nc" id="L1907">            boolean old = this.chart.getPlot().isNotify();</span>
<span class="nc" id="L1908">            this.chart.getPlot().setNotify(false);</span>
<span class="nc" id="L1909">            Pannable p = (Pannable) this.chart.getPlot();</span>
<span class="nc bnc" id="L1910" title="All 2 branches missed.">            if (p.getOrientation() == PlotOrientation.VERTICAL) {</span>
<span class="nc" id="L1911">                p.panDomainAxes(wPercent, this.info.getPlotInfo(),</span>
<span class="nc" id="L1912">                        this.panLast);</span>
<span class="nc" id="L1913">                p.panRangeAxes(hPercent, this.info.getPlotInfo(),</span>
<span class="nc" id="L1914">                        this.panLast);</span>
<span class="nc" id="L1915">            }</span>
            else {
<span class="nc" id="L1917">                p.panDomainAxes(hPercent, this.info.getPlotInfo(),</span>
<span class="nc" id="L1918">                        this.panLast);</span>
<span class="nc" id="L1919">                p.panRangeAxes(wPercent, this.info.getPlotInfo(),</span>
<span class="nc" id="L1920">                        this.panLast);</span>
            }
<span class="nc" id="L1922">            this.panLast = e.getPoint();</span>
<span class="nc" id="L1923">            this.chart.getPlot().setNotify(old);</span>
<span class="nc" id="L1924">            return;</span>
        }

        // if no initial zoom point was set, ignore dragging...
<span class="nc bnc" id="L1928" title="All 2 branches missed.">        if (this.zoomPoint == null) {</span>
<span class="nc" id="L1929">            return;</span>
        }
<span class="nc" id="L1931">        Graphics2D g2 = (Graphics2D) getGraphics();</span>

        // erase the previous zoom rectangle (if any).  We only need to do
        // this is we are using XOR mode, which we do when we're not using
        // the buffer (if there is a buffer, then at the end of this method we
        // just trigger a repaint)
<span class="nc bnc" id="L1937" title="All 2 branches missed.">        if (!this.useBuffer) {</span>
<span class="nc" id="L1938">            drawZoomRectangle(g2, true);</span>
        }

        boolean hZoom, vZoom;
<span class="nc bnc" id="L1942" title="All 2 branches missed.">        if (this.orientation == PlotOrientation.HORIZONTAL) {</span>
<span class="nc" id="L1943">            hZoom = this.rangeZoomable;</span>
<span class="nc" id="L1944">            vZoom = this.domainZoomable;</span>
<span class="nc" id="L1945">        }</span>
        else {
<span class="nc" id="L1947">            hZoom = this.domainZoomable;</span>
<span class="nc" id="L1948">            vZoom = this.rangeZoomable;</span>
        }
<span class="nc" id="L1950">        Rectangle2D scaledDataArea = getScreenDataArea(</span>
<span class="nc" id="L1951">                (int) this.zoomPoint.getX(), (int) this.zoomPoint.getY());</span>
<span class="nc bnc" id="L1952" title="All 4 branches missed.">        if (hZoom &amp;&amp; vZoom) {</span>
            // selected rectangle shouldn't extend outside the data area...
<span class="nc" id="L1954">            double xmax = Math.min(e.getX(), scaledDataArea.getMaxX());</span>
<span class="nc" id="L1955">            double ymax = Math.min(e.getY(), scaledDataArea.getMaxY());</span>
<span class="nc" id="L1956">            this.zoomRectangle = new Rectangle2D.Double(</span>
<span class="nc" id="L1957">                    this.zoomPoint.getX(), this.zoomPoint.getY(),</span>
<span class="nc" id="L1958">                    xmax - this.zoomPoint.getX(), ymax - this.zoomPoint.getY());</span>
<span class="nc" id="L1959">        }</span>
<span class="nc bnc" id="L1960" title="All 2 branches missed.">        else if (hZoom) {</span>
<span class="nc" id="L1961">            double xmax = Math.min(e.getX(), scaledDataArea.getMaxX());</span>
<span class="nc" id="L1962">            this.zoomRectangle = new Rectangle2D.Double(</span>
<span class="nc" id="L1963">                    this.zoomPoint.getX(), scaledDataArea.getMinY(),</span>
<span class="nc" id="L1964">                    xmax - this.zoomPoint.getX(), scaledDataArea.getHeight());</span>
<span class="nc" id="L1965">        }</span>
<span class="nc bnc" id="L1966" title="All 2 branches missed.">        else if (vZoom) {</span>
<span class="nc" id="L1967">            double ymax = Math.min(e.getY(), scaledDataArea.getMaxY());</span>
<span class="nc" id="L1968">            this.zoomRectangle = new Rectangle2D.Double(</span>
<span class="nc" id="L1969">                    scaledDataArea.getMinX(), this.zoomPoint.getY(),</span>
<span class="nc" id="L1970">                    scaledDataArea.getWidth(), ymax - this.zoomPoint.getY());</span>
        }

        // Draw the new zoom rectangle...
<span class="nc bnc" id="L1974" title="All 2 branches missed.">        if (this.useBuffer) {</span>
<span class="nc" id="L1975">            repaint();</span>
<span class="nc" id="L1976">        }</span>
        else {
            // with no buffer, we use XOR to draw the rectangle &quot;over&quot; the
            // chart...
<span class="nc" id="L1980">            drawZoomRectangle(g2, true);</span>
        }
<span class="nc" id="L1982">        g2.dispose();</span>

<span class="nc" id="L1984">    }</span>

    /**
     * Handles a 'mouse released' event.  On Windows, we need to check if this
     * is a popup trigger, but only if we haven't already been tracking a zoom
     * rectangle.
     *
     * @param e  information about the event.
     */
    @Override
    public void mouseReleased(MouseEvent e) {

        // if we've been panning, we need to reset now that the mouse is 
        // released...
<span class="nc bnc" id="L1998" title="All 2 branches missed.">        if (this.panLast != null) {</span>
<span class="nc" id="L1999">            this.panLast = null;</span>
<span class="nc" id="L2000">            setCursor(Cursor.getDefaultCursor());</span>
<span class="nc" id="L2001">        }</span>

<span class="nc bnc" id="L2003" title="All 2 branches missed.">        else if (this.zoomRectangle != null) {</span>
            boolean hZoom, vZoom;
<span class="nc bnc" id="L2005" title="All 2 branches missed.">            if (this.orientation == PlotOrientation.HORIZONTAL) {</span>
<span class="nc" id="L2006">                hZoom = this.rangeZoomable;</span>
<span class="nc" id="L2007">                vZoom = this.domainZoomable;</span>
<span class="nc" id="L2008">            }</span>
            else {
<span class="nc" id="L2010">                hZoom = this.domainZoomable;</span>
<span class="nc" id="L2011">                vZoom = this.rangeZoomable;</span>
            }

<span class="nc bnc" id="L2014" title="All 4 branches missed.">            boolean zoomTrigger1 = hZoom &amp;&amp; Math.abs(e.getX()</span>
<span class="nc" id="L2015">                - this.zoomPoint.getX()) &gt;= this.zoomTriggerDistance;</span>
<span class="nc bnc" id="L2016" title="All 4 branches missed.">            boolean zoomTrigger2 = vZoom &amp;&amp; Math.abs(e.getY()</span>
<span class="nc" id="L2017">                - this.zoomPoint.getY()) &gt;= this.zoomTriggerDistance;</span>
<span class="nc bnc" id="L2018" title="All 4 branches missed.">            if (zoomTrigger1 || zoomTrigger2) {</span>
<span class="nc bnc" id="L2019" title="All 4 branches missed.">                if ((hZoom &amp;&amp; (e.getX() &lt; this.zoomPoint.getX()))</span>
<span class="nc bnc" id="L2020" title="All 4 branches missed.">                    || (vZoom &amp;&amp; (e.getY() &lt; this.zoomPoint.getY()))) {</span>
<span class="nc" id="L2021">                    restoreAutoBounds();</span>
<span class="nc" id="L2022">                }</span>
                else {
                    double x, y, w, h;
<span class="nc" id="L2025">                    Rectangle2D screenDataArea = getScreenDataArea(</span>
<span class="nc" id="L2026">                            (int) this.zoomPoint.getX(),</span>
<span class="nc" id="L2027">                            (int) this.zoomPoint.getY());</span>
<span class="nc" id="L2028">                    double maxX = screenDataArea.getMaxX();</span>
<span class="nc" id="L2029">                    double maxY = screenDataArea.getMaxY();</span>
                    // for mouseReleased event, (horizontalZoom || verticalZoom)
                    // will be true, so we can just test for either being false;
                    // otherwise both are true
<span class="nc bnc" id="L2033" title="All 2 branches missed.">                    if (!vZoom) {</span>
<span class="nc" id="L2034">                        x = this.zoomPoint.getX();</span>
<span class="nc" id="L2035">                        y = screenDataArea.getMinY();</span>
<span class="nc" id="L2036">                        w = Math.min(this.zoomRectangle.getWidth(),</span>
<span class="nc" id="L2037">                                maxX - this.zoomPoint.getX());</span>
<span class="nc" id="L2038">                        h = screenDataArea.getHeight();</span>
<span class="nc" id="L2039">                    }</span>
<span class="nc bnc" id="L2040" title="All 2 branches missed.">                    else if (!hZoom) {</span>
<span class="nc" id="L2041">                        x = screenDataArea.getMinX();</span>
<span class="nc" id="L2042">                        y = this.zoomPoint.getY();</span>
<span class="nc" id="L2043">                        w = screenDataArea.getWidth();</span>
<span class="nc" id="L2044">                        h = Math.min(this.zoomRectangle.getHeight(),</span>
<span class="nc" id="L2045">                                maxY - this.zoomPoint.getY());</span>
<span class="nc" id="L2046">                    }</span>
                    else {
<span class="nc" id="L2048">                        x = this.zoomPoint.getX();</span>
<span class="nc" id="L2049">                        y = this.zoomPoint.getY();</span>
<span class="nc" id="L2050">                        w = Math.min(this.zoomRectangle.getWidth(),</span>
<span class="nc" id="L2051">                                maxX - this.zoomPoint.getX());</span>
<span class="nc" id="L2052">                        h = Math.min(this.zoomRectangle.getHeight(),</span>
<span class="nc" id="L2053">                                maxY - this.zoomPoint.getY());</span>
                    }
<span class="nc" id="L2055">                    Rectangle2D zoomArea = new Rectangle2D.Double(x, y, w, h);</span>
<span class="nc" id="L2056">                    zoom(zoomArea);</span>
                }
<span class="nc" id="L2058">                this.zoomPoint = null;</span>
<span class="nc" id="L2059">                this.zoomRectangle = null;</span>
<span class="nc" id="L2060">            }</span>
            else {
                // erase the zoom rectangle
<span class="nc" id="L2063">                Graphics2D g2 = (Graphics2D) getGraphics();</span>
<span class="nc bnc" id="L2064" title="All 2 branches missed.">                if (this.useBuffer) {</span>
<span class="nc" id="L2065">                    repaint();</span>
<span class="nc" id="L2066">                }</span>
                else {
<span class="nc" id="L2068">                    drawZoomRectangle(g2, true);</span>
                }
<span class="nc" id="L2070">                g2.dispose();</span>
<span class="nc" id="L2071">                this.zoomPoint = null;</span>
<span class="nc" id="L2072">                this.zoomRectangle = null;</span>
            }

<span class="nc" id="L2075">        }</span>

<span class="nc bnc" id="L2077" title="All 2 branches missed.">        else if (e.isPopupTrigger()) {</span>
<span class="nc bnc" id="L2078" title="All 2 branches missed.">            if (this.popup != null) {</span>
<span class="nc" id="L2079">                displayPopupMenu(e.getX(), e.getY());</span>
            }
        }

<span class="nc" id="L2083">    }</span>

    /**
     * Receives notification of mouse clicks on the panel. These are
     * translated and passed on to any registered {@link ChartMouseListener}s.
     *
     * @param event  Information about the mouse event.
     */
    @Override
    public void mouseClicked(MouseEvent event) {

<span class="nc" id="L2094">        Insets insets = getInsets();</span>
<span class="nc" id="L2095">        int x = (int) ((event.getX() - insets.left) / this.scaleX);</span>
<span class="nc" id="L2096">        int y = (int) ((event.getY() - insets.top) / this.scaleY);</span>

<span class="nc" id="L2098">        this.anchor = new Point2D.Double(x, y);</span>
<span class="nc bnc" id="L2099" title="All 2 branches missed.">        if (this.chart == null) {</span>
<span class="nc" id="L2100">            return;</span>
        }
<span class="nc" id="L2102">        this.chart.setNotify(true);  // force a redraw</span>
        // new entity code...
<span class="nc" id="L2104">        Object[] listeners = this.chartMouseListeners.getListeners(</span>
<span class="nc" id="L2105">                ChartMouseListener.class);</span>
<span class="nc bnc" id="L2106" title="All 2 branches missed.">        if (listeners.length == 0) {</span>
<span class="nc" id="L2107">            return;</span>
        }

<span class="nc" id="L2110">        ChartEntity entity = null;</span>
<span class="nc bnc" id="L2111" title="All 2 branches missed.">        if (this.info != null) {</span>
<span class="nc" id="L2112">            EntityCollection entities = this.info.getEntityCollection();</span>
<span class="nc bnc" id="L2113" title="All 2 branches missed.">            if (entities != null) {</span>
<span class="nc" id="L2114">                entity = entities.getEntity(x, y);</span>
            }
        }
<span class="nc" id="L2117">        ChartMouseEvent chartEvent = new ChartMouseEvent(getChart(), event,</span>
<span class="nc" id="L2118">                entity);</span>
<span class="nc bnc" id="L2119" title="All 2 branches missed.">        for (int i = listeners.length - 1; i &gt;= 0; i -= 1) {</span>
<span class="nc" id="L2120">            ((ChartMouseListener) listeners[i]).chartMouseClicked(chartEvent);</span>
        }

<span class="nc" id="L2123">    }</span>

    /**
     * Implementation of the MouseMotionListener's method.
     *
     * @param e  the event.
     */
    @Override
    public void mouseMoved(MouseEvent e) {
<span class="nc" id="L2132">        Graphics2D g2 = (Graphics2D) getGraphics();</span>
<span class="nc bnc" id="L2133" title="All 2 branches missed.">        if (this.horizontalAxisTrace) {</span>
<span class="nc" id="L2134">            drawHorizontalAxisTrace(g2, e.getX());</span>
        }
<span class="nc bnc" id="L2136" title="All 2 branches missed.">        if (this.verticalAxisTrace) {</span>
<span class="nc" id="L2137">            drawVerticalAxisTrace(g2, e.getY());</span>
        }
<span class="nc" id="L2139">        g2.dispose();</span>

<span class="nc" id="L2141">        Object[] listeners = this.chartMouseListeners.getListeners(</span>
<span class="nc" id="L2142">                ChartMouseListener.class);</span>
<span class="nc bnc" id="L2143" title="All 2 branches missed.">        if (listeners.length == 0) {</span>
<span class="nc" id="L2144">            return;</span>
        }
<span class="nc" id="L2146">        Insets insets = getInsets();</span>
<span class="nc" id="L2147">        int x = (int) ((e.getX() - insets.left) / this.scaleX);</span>
<span class="nc" id="L2148">        int y = (int) ((e.getY() - insets.top) / this.scaleY);</span>

<span class="nc" id="L2150">        ChartEntity entity = null;</span>
<span class="nc bnc" id="L2151" title="All 2 branches missed.">        if (this.info != null) {</span>
<span class="nc" id="L2152">            EntityCollection entities = this.info.getEntityCollection();</span>
<span class="nc bnc" id="L2153" title="All 2 branches missed.">            if (entities != null) {</span>
<span class="nc" id="L2154">                entity = entities.getEntity(x, y);</span>
            }
        }

        // we can only generate events if the panel's chart is not null
        // (see bug report 1556951)
<span class="nc bnc" id="L2160" title="All 2 branches missed.">        if (this.chart != null) {</span>
<span class="nc" id="L2161">            ChartMouseEvent event = new ChartMouseEvent(getChart(), e, entity);</span>
<span class="nc bnc" id="L2162" title="All 2 branches missed.">            for (int i = listeners.length - 1; i &gt;= 0; i -= 1) {</span>
<span class="nc" id="L2163">                ((ChartMouseListener) listeners[i]).chartMouseMoved(event);</span>
            }
        }

<span class="nc" id="L2167">    }</span>

    /**
     * Zooms in on an anchor point (specified in screen coordinate space).
     *
     * @param x  the x value (in screen coordinates).
     * @param y  the y value (in screen coordinates).
     */
    public void zoomInBoth(double x, double y) {
<span class="nc" id="L2176">        Plot plot = this.chart.getPlot();</span>
<span class="nc bnc" id="L2177" title="All 2 branches missed.">        if (plot == null) {</span>
<span class="nc" id="L2178">            return;</span>
        }
        // here we tweak the notify flag on the plot so that only
        // one notification happens even though we update multiple
        // axes...
<span class="nc" id="L2183">        boolean savedNotify = plot.isNotify();</span>
<span class="nc" id="L2184">        plot.setNotify(false);</span>
<span class="nc" id="L2185">        zoomInDomain(x, y);</span>
<span class="nc" id="L2186">        zoomInRange(x, y);</span>
<span class="nc" id="L2187">        plot.setNotify(savedNotify);</span>
<span class="nc" id="L2188">    }</span>

    /**
     * Decreases the length of the domain axis, centered about the given
     * coordinate on the screen.  The length of the domain axis is reduced
     * by the value of {@link #getZoomInFactor()}.
     *
     * @param x  the x coordinate (in screen coordinates).
     * @param y  the y-coordinate (in screen coordinates).
     */
    public void zoomInDomain(double x, double y) {
<span class="nc" id="L2199">        Plot plot = this.chart.getPlot();</span>
<span class="nc bnc" id="L2200" title="All 2 branches missed.">        if (plot instanceof Zoomable) {</span>
            // here we tweak the notify flag on the plot so that only
            // one notification happens even though we update multiple
            // axes...
<span class="nc" id="L2204">            boolean savedNotify = plot.isNotify();</span>
<span class="nc" id="L2205">            plot.setNotify(false);</span>
<span class="nc" id="L2206">            Zoomable z = (Zoomable) plot;</span>
<span class="nc" id="L2207">            z.zoomDomainAxes(this.zoomInFactor, this.info.getPlotInfo(),</span>
<span class="nc" id="L2208">                    translateScreenToJava2D(new Point((int) x, (int) y)),</span>
<span class="nc" id="L2209">                    this.zoomAroundAnchor);</span>
<span class="nc" id="L2210">            plot.setNotify(savedNotify);</span>
        }
<span class="nc" id="L2212">    }</span>

    /**
     * Decreases the length of the range axis, centered about the given
     * coordinate on the screen.  The length of the range axis is reduced by
     * the value of {@link #getZoomInFactor()}.
     *
     * @param x  the x-coordinate (in screen coordinates).
     * @param y  the y coordinate (in screen coordinates).
     */
    public void zoomInRange(double x, double y) {
<span class="nc" id="L2223">        Plot plot = this.chart.getPlot();</span>
<span class="nc bnc" id="L2224" title="All 2 branches missed.">        if (plot instanceof Zoomable) {</span>
            // here we tweak the notify flag on the plot so that only
            // one notification happens even though we update multiple
            // axes...
<span class="nc" id="L2228">            boolean savedNotify = plot.isNotify();</span>
<span class="nc" id="L2229">            plot.setNotify(false);</span>
<span class="nc" id="L2230">            Zoomable z = (Zoomable) plot;</span>
<span class="nc" id="L2231">            z.zoomRangeAxes(this.zoomInFactor, this.info.getPlotInfo(),</span>
<span class="nc" id="L2232">                    translateScreenToJava2D(new Point((int) x, (int) y)),</span>
<span class="nc" id="L2233">                    this.zoomAroundAnchor);</span>
<span class="nc" id="L2234">            plot.setNotify(savedNotify);</span>
        }
<span class="nc" id="L2236">    }</span>

    /**
     * Zooms out on an anchor point (specified in screen coordinate space).
     *
     * @param x  the x value (in screen coordinates).
     * @param y  the y value (in screen coordinates).
     */
    public void zoomOutBoth(double x, double y) {
<span class="nc" id="L2245">        Plot plot = this.chart.getPlot();</span>
<span class="nc bnc" id="L2246" title="All 2 branches missed.">        if (plot == null) {</span>
<span class="nc" id="L2247">            return;</span>
        }
        // here we tweak the notify flag on the plot so that only
        // one notification happens even though we update multiple
        // axes...
<span class="nc" id="L2252">        boolean savedNotify = plot.isNotify();</span>
<span class="nc" id="L2253">        plot.setNotify(false);</span>
<span class="nc" id="L2254">        zoomOutDomain(x, y);</span>
<span class="nc" id="L2255">        zoomOutRange(x, y);</span>
<span class="nc" id="L2256">        plot.setNotify(savedNotify);</span>
<span class="nc" id="L2257">    }</span>

    /**
     * Increases the length of the domain axis, centered about the given
     * coordinate on the screen.  The length of the domain axis is increased
     * by the value of {@link #getZoomOutFactor()}.
     *
     * @param x  the x coordinate (in screen coordinates).
     * @param y  the y-coordinate (in screen coordinates).
     */
    public void zoomOutDomain(double x, double y) {
<span class="nc" id="L2268">        Plot plot = this.chart.getPlot();</span>
<span class="nc bnc" id="L2269" title="All 2 branches missed.">        if (plot instanceof Zoomable) {</span>
            // here we tweak the notify flag on the plot so that only
            // one notification happens even though we update multiple
            // axes...
<span class="nc" id="L2273">            boolean savedNotify = plot.isNotify();</span>
<span class="nc" id="L2274">            plot.setNotify(false);</span>
<span class="nc" id="L2275">            Zoomable z = (Zoomable) plot;</span>
<span class="nc" id="L2276">            z.zoomDomainAxes(this.zoomOutFactor, this.info.getPlotInfo(),</span>
<span class="nc" id="L2277">                    translateScreenToJava2D(new Point((int) x, (int) y)),</span>
<span class="nc" id="L2278">                    this.zoomAroundAnchor);</span>
<span class="nc" id="L2279">            plot.setNotify(savedNotify);</span>
        }
<span class="nc" id="L2281">    }</span>

    /**
     * Increases the length the range axis, centered about the given
     * coordinate on the screen.  The length of the range axis is increased
     * by the value of {@link #getZoomOutFactor()}.
     *
     * @param x  the x coordinate (in screen coordinates).
     * @param y  the y-coordinate (in screen coordinates).
     */
    public void zoomOutRange(double x, double y) {
<span class="nc" id="L2292">        Plot plot = this.chart.getPlot();</span>
<span class="nc bnc" id="L2293" title="All 2 branches missed.">        if (plot instanceof Zoomable) {</span>
            // here we tweak the notify flag on the plot so that only
            // one notification happens even though we update multiple
            // axes...
<span class="nc" id="L2297">            boolean savedNotify = plot.isNotify();</span>
<span class="nc" id="L2298">            plot.setNotify(false);</span>
<span class="nc" id="L2299">            Zoomable z = (Zoomable) plot;</span>
<span class="nc" id="L2300">            z.zoomRangeAxes(this.zoomOutFactor, this.info.getPlotInfo(),</span>
<span class="nc" id="L2301">                    translateScreenToJava2D(new Point((int) x, (int) y)),</span>
<span class="nc" id="L2302">                    this.zoomAroundAnchor);</span>
<span class="nc" id="L2303">            plot.setNotify(savedNotify);</span>
        }
<span class="nc" id="L2305">    }</span>

    /**
     * Zooms in on a selected region.
     *
     * @param selection  the selected region.
     */
    public void zoom(Rectangle2D selection) {

        // get the origin of the zoom selection in the Java2D space used for
        // drawing the chart (that is, before any scaling to fit the panel)
<span class="nc" id="L2316">        Point2D selectOrigin = translateScreenToJava2D(new Point(</span>
<span class="nc" id="L2317">                (int) Math.ceil(selection.getX()),</span>
<span class="nc" id="L2318">                (int) Math.ceil(selection.getY())));</span>
<span class="nc" id="L2319">        PlotRenderingInfo plotInfo = this.info.getPlotInfo();</span>
<span class="nc" id="L2320">        Rectangle2D scaledDataArea = getScreenDataArea(</span>
<span class="nc" id="L2321">                (int) selection.getCenterX(), (int) selection.getCenterY());</span>
<span class="nc bnc" id="L2322" title="All 4 branches missed.">        if ((selection.getHeight() &gt; 0) &amp;&amp; (selection.getWidth() &gt; 0)) {</span>

<span class="nc" id="L2324">            double hLower = (selection.getMinX() - scaledDataArea.getMinX())</span>
<span class="nc" id="L2325">                / scaledDataArea.getWidth();</span>
<span class="nc" id="L2326">            double hUpper = (selection.getMaxX() - scaledDataArea.getMinX())</span>
<span class="nc" id="L2327">                / scaledDataArea.getWidth();</span>
<span class="nc" id="L2328">            double vLower = (scaledDataArea.getMaxY() - selection.getMaxY())</span>
<span class="nc" id="L2329">                / scaledDataArea.getHeight();</span>
<span class="nc" id="L2330">            double vUpper = (scaledDataArea.getMaxY() - selection.getMinY())</span>
<span class="nc" id="L2331">                / scaledDataArea.getHeight();</span>

<span class="nc" id="L2333">            Plot p = this.chart.getPlot();</span>
<span class="nc bnc" id="L2334" title="All 2 branches missed.">            if (p instanceof Zoomable) {</span>
                // here we tweak the notify flag on the plot so that only
                // one notification happens even though we update multiple
                // axes...
<span class="nc" id="L2338">                boolean savedNotify = p.isNotify();</span>
<span class="nc" id="L2339">                p.setNotify(false);</span>
<span class="nc" id="L2340">                Zoomable z = (Zoomable) p;</span>
<span class="nc bnc" id="L2341" title="All 2 branches missed.">                if (z.getOrientation() == PlotOrientation.HORIZONTAL) {</span>
<span class="nc" id="L2342">                    z.zoomDomainAxes(vLower, vUpper, plotInfo, selectOrigin);</span>
<span class="nc" id="L2343">                    z.zoomRangeAxes(hLower, hUpper, plotInfo, selectOrigin);</span>
<span class="nc" id="L2344">                }</span>
                else {
<span class="nc" id="L2346">                    z.zoomDomainAxes(hLower, hUpper, plotInfo, selectOrigin);</span>
<span class="nc" id="L2347">                    z.zoomRangeAxes(vLower, vUpper, plotInfo, selectOrigin);</span>
                }
<span class="nc" id="L2349">                p.setNotify(savedNotify);</span>
            }

        }

<span class="nc" id="L2354">    }</span>

    /**
     * Restores the auto-range calculation on both axes.
     */
    public void restoreAutoBounds() {
<span class="nc" id="L2360">        Plot plot = this.chart.getPlot();</span>
<span class="nc bnc" id="L2361" title="All 2 branches missed.">        if (plot == null) {</span>
<span class="nc" id="L2362">            return;</span>
        }
        // here we tweak the notify flag on the plot so that only
        // one notification happens even though we update multiple
        // axes...
<span class="nc" id="L2367">        boolean savedNotify = plot.isNotify();</span>
<span class="nc" id="L2368">        plot.setNotify(false);</span>
<span class="nc" id="L2369">        restoreAutoDomainBounds();</span>
<span class="nc" id="L2370">        restoreAutoRangeBounds();</span>
<span class="nc" id="L2371">        plot.setNotify(savedNotify);</span>
<span class="nc" id="L2372">    }</span>

    /**
     * Restores the auto-range calculation on the domain axis.
     */
    public void restoreAutoDomainBounds() {
<span class="nc" id="L2378">        Plot plot = this.chart.getPlot();</span>
<span class="nc bnc" id="L2379" title="All 2 branches missed.">        if (plot instanceof Zoomable) {</span>
<span class="nc" id="L2380">            Zoomable z = (Zoomable) plot;</span>
            // here we tweak the notify flag on the plot so that only
            // one notification happens even though we update multiple
            // axes...
<span class="nc" id="L2384">            boolean savedNotify = plot.isNotify();</span>
<span class="nc" id="L2385">            plot.setNotify(false);</span>
            // we need to guard against this.zoomPoint being null
<span class="nc bnc" id="L2387" title="All 2 branches missed.">            Point2D zp = (this.zoomPoint != null</span>
<span class="nc" id="L2388">                    ? this.zoomPoint : new Point());</span>
<span class="nc" id="L2389">            z.zoomDomainAxes(0.0, this.info.getPlotInfo(), zp);</span>
<span class="nc" id="L2390">            plot.setNotify(savedNotify);</span>
        }
<span class="nc" id="L2392">    }</span>

    /**
     * Restores the auto-range calculation on the range axis.
     */
    public void restoreAutoRangeBounds() {
<span class="nc" id="L2398">        Plot plot = this.chart.getPlot();</span>
<span class="nc bnc" id="L2399" title="All 2 branches missed.">        if (plot instanceof Zoomable) {</span>
<span class="nc" id="L2400">            Zoomable z = (Zoomable) plot;</span>
            // here we tweak the notify flag on the plot so that only
            // one notification happens even though we update multiple
            // axes...
<span class="nc" id="L2404">            boolean savedNotify = plot.isNotify();</span>
<span class="nc" id="L2405">            plot.setNotify(false);</span>
            // we need to guard against this.zoomPoint being null
<span class="nc bnc" id="L2407" title="All 2 branches missed.">            Point2D zp = (this.zoomPoint != null</span>
<span class="nc" id="L2408">                    ? this.zoomPoint : new Point());</span>
<span class="nc" id="L2409">            z.zoomRangeAxes(0.0, this.info.getPlotInfo(), zp);</span>
<span class="nc" id="L2410">            plot.setNotify(savedNotify);</span>
        }
<span class="nc" id="L2412">    }</span>

    /**
     * Returns the data area for the chart (the area inside the axes) with the
     * current scaling applied (that is, the area as it appears on screen).
     *
     * @return The scaled data area.
     */
    public Rectangle2D getScreenDataArea() {
<span class="nc" id="L2421">        Rectangle2D dataArea = this.info.getPlotInfo().getDataArea();</span>
<span class="nc" id="L2422">        Insets insets = getInsets();</span>
<span class="nc" id="L2423">        double x = dataArea.getX() * this.scaleX + insets.left;</span>
<span class="nc" id="L2424">        double y = dataArea.getY() * this.scaleY + insets.top;</span>
<span class="nc" id="L2425">        double w = dataArea.getWidth() * this.scaleX;</span>
<span class="nc" id="L2426">        double h = dataArea.getHeight() * this.scaleY;</span>
<span class="nc" id="L2427">        return new Rectangle2D.Double(x, y, w, h);</span>
    }

    /**
     * Returns the data area (the area inside the axes) for the plot or subplot,
     * with the current scaling applied.
     *
     * @param x  the x-coordinate (for subplot selection).
     * @param y  the y-coordinate (for subplot selection).
     *
     * @return The scaled data area.
     */
    public Rectangle2D getScreenDataArea(int x, int y) {
<span class="nc" id="L2440">        PlotRenderingInfo plotInfo = this.info.getPlotInfo();</span>
        Rectangle2D result;
<span class="nc bnc" id="L2442" title="All 2 branches missed.">        if (plotInfo.getSubplotCount() == 0) {</span>
<span class="nc" id="L2443">            result = getScreenDataArea();</span>
<span class="nc" id="L2444">        }</span>
        else {
            // get the origin of the zoom selection in the Java2D space used for
            // drawing the chart (that is, before any scaling to fit the panel)
<span class="nc" id="L2448">            Point2D selectOrigin = translateScreenToJava2D(new Point(x, y));</span>
<span class="nc" id="L2449">            int subplotIndex = plotInfo.getSubplotIndex(selectOrigin);</span>
<span class="nc bnc" id="L2450" title="All 2 branches missed.">            if (subplotIndex == -1) {</span>
<span class="nc" id="L2451">                return null;</span>
            }
<span class="nc" id="L2453">            result = scale(plotInfo.getSubplotInfo(subplotIndex).getDataArea());</span>
        }
<span class="nc" id="L2455">        return result;</span>
    }

    /**
     * Returns the initial tooltip delay value used inside this chart panel.
     *
     * @return An integer representing the initial delay value, in milliseconds.
     *
     * @see javax.swing.ToolTipManager#getInitialDelay()
     */
    public int getInitialDelay() {
<span class="nc" id="L2466">        return this.ownToolTipInitialDelay;</span>
    }

    /**
     * Returns the reshow tooltip delay value used inside this chart panel.
     *
     * @return An integer representing the reshow  delay value, in milliseconds.
     *
     * @see javax.swing.ToolTipManager#getReshowDelay()
     */
    public int getReshowDelay() {
<span class="nc" id="L2477">        return this.ownToolTipReshowDelay;</span>
    }

    /**
     * Returns the dismissal tooltip delay value used inside this chart panel.
     *
     * @return An integer representing the dismissal delay value, in
     *         milliseconds.
     *
     * @see javax.swing.ToolTipManager#getDismissDelay()
     */
    public int getDismissDelay() {
<span class="nc" id="L2489">        return this.ownToolTipDismissDelay;</span>
    }

    /**
     * Specifies the initial delay value for this chart panel.
     *
     * @param delay  the number of milliseconds to delay (after the cursor has
     *               paused) before displaying.
     *
     * @see javax.swing.ToolTipManager#setInitialDelay(int)
     */
    public void setInitialDelay(int delay) {
<span class="nc" id="L2501">        this.ownToolTipInitialDelay = delay;</span>
<span class="nc" id="L2502">    }</span>

    /**
     * Specifies the amount of time before the user has to wait initialDelay
     * milliseconds before a tooltip will be shown.
     *
     * @param delay  time in milliseconds
     *
     * @see javax.swing.ToolTipManager#setReshowDelay(int)
     */
    public void setReshowDelay(int delay) {
<span class="nc" id="L2513">        this.ownToolTipReshowDelay = delay;</span>
<span class="nc" id="L2514">    }</span>

    /**
     * Specifies the dismissal delay value for this chart panel.
     *
     * @param delay the number of milliseconds to delay before taking away the
     *              tooltip
     *
     * @see javax.swing.ToolTipManager#setDismissDelay(int)
     */
    public void setDismissDelay(int delay) {
<span class="nc" id="L2525">        this.ownToolTipDismissDelay = delay;</span>
<span class="nc" id="L2526">    }</span>

    /**
     * Returns the zoom in factor.
     *
     * @return The zoom in factor.
     *
     * @see #setZoomInFactor(double)
     */
    public double getZoomInFactor() {
<span class="nc" id="L2536">        return this.zoomInFactor;</span>
    }

    /**
     * Sets the zoom in factor.
     *
     * @param factor  the factor.
     *
     * @see #getZoomInFactor()
     */
    public void setZoomInFactor(double factor) {
<span class="nc" id="L2547">        this.zoomInFactor = factor;</span>
<span class="nc" id="L2548">    }</span>

    /**
     * Returns the zoom out factor.
     *
     * @return The zoom out factor.
     *
     * @see #setZoomOutFactor(double)
     */
    public double getZoomOutFactor() {
<span class="nc" id="L2558">        return this.zoomOutFactor;</span>
    }

    /**
     * Sets the zoom out factor.
     *
     * @param factor  the factor.
     *
     * @see #getZoomOutFactor()
     */
    public void setZoomOutFactor(double factor) {
<span class="nc" id="L2569">        this.zoomOutFactor = factor;</span>
<span class="nc" id="L2570">    }</span>

    /**
     * Draws zoom rectangle (if present).
     * The drawing is performed in XOR mode, therefore
     * when this method is called twice in a row,
     * the second call will completely restore the state
     * of the canvas.
     *
     * @param g2 the graphics device.
     * @param xor  use XOR for drawing?
     */
    private void drawZoomRectangle(Graphics2D g2, boolean xor) {
<span class="nc bnc" id="L2583" title="All 2 branches missed.">        if (this.zoomRectangle != null) {</span>
<span class="nc bnc" id="L2584" title="All 2 branches missed.">            if (xor) {</span>
                 // Set XOR mode to draw the zoom rectangle
<span class="nc" id="L2586">                g2.setXORMode(Color.gray);</span>
            }
<span class="nc bnc" id="L2588" title="All 2 branches missed.">            if (this.fillZoomRectangle) {</span>
<span class="nc" id="L2589">                g2.setPaint(this.zoomFillPaint);</span>
<span class="nc" id="L2590">                g2.fill(this.zoomRectangle);</span>
<span class="nc" id="L2591">            }</span>
            else {
<span class="nc" id="L2593">                g2.setPaint(this.zoomOutlinePaint);</span>
<span class="nc" id="L2594">                g2.draw(this.zoomRectangle);</span>
            }
<span class="nc bnc" id="L2596" title="All 2 branches missed.">            if (xor) {</span>
                // Reset to the default 'overwrite' mode
<span class="nc" id="L2598">                g2.setPaintMode();</span>
            }
        }
<span class="nc" id="L2601">    }</span>

    /**
     * Draws a vertical line used to trace the mouse position to the horizontal
     * axis.
     *
     * @param g2 the graphics device.
     * @param x  the x-coordinate of the trace line.
     */
    private void drawHorizontalAxisTrace(Graphics2D g2, int x) {

<span class="nc" id="L2612">        Rectangle2D dataArea = getScreenDataArea();</span>

<span class="nc" id="L2614">        g2.setXORMode(Color.orange);</span>
<span class="nc bnc" id="L2615" title="All 4 branches missed.">        if (((int) dataArea.getMinX() &lt; x) &amp;&amp; (x &lt; (int) dataArea.getMaxX())) {</span>

<span class="nc bnc" id="L2617" title="All 2 branches missed.">            if (this.verticalTraceLine != null) {</span>
<span class="nc" id="L2618">                g2.draw(this.verticalTraceLine);</span>
<span class="nc" id="L2619">                this.verticalTraceLine.setLine(x, (int) dataArea.getMinY(), x,</span>
<span class="nc" id="L2620">                        (int) dataArea.getMaxY());</span>
<span class="nc" id="L2621">            }</span>
            else {
<span class="nc" id="L2623">                this.verticalTraceLine = new Line2D.Float(x,</span>
<span class="nc" id="L2624">                        (int) dataArea.getMinY(), x, (int) dataArea.getMaxY());</span>
            }
<span class="nc" id="L2626">            g2.draw(this.verticalTraceLine);</span>
        }

        // Reset to the default 'overwrite' mode
<span class="nc" id="L2630">        g2.setPaintMode();</span>
<span class="nc" id="L2631">    }</span>

    /**
     * Draws a horizontal line used to trace the mouse position to the vertical
     * axis.
     *
     * @param g2 the graphics device.
     * @param y  the y-coordinate of the trace line.
     */
    private void drawVerticalAxisTrace(Graphics2D g2, int y) {

<span class="nc" id="L2642">        Rectangle2D dataArea = getScreenDataArea();</span>

<span class="nc" id="L2644">        g2.setXORMode(Color.orange);</span>
<span class="nc bnc" id="L2645" title="All 4 branches missed.">        if (((int) dataArea.getMinY() &lt; y) &amp;&amp; (y &lt; (int) dataArea.getMaxY())) {</span>

<span class="nc bnc" id="L2647" title="All 2 branches missed.">            if (this.horizontalTraceLine != null) {</span>
<span class="nc" id="L2648">                g2.draw(this.horizontalTraceLine);</span>
<span class="nc" id="L2649">                this.horizontalTraceLine.setLine((int) dataArea.getMinX(), y,</span>
<span class="nc" id="L2650">                        (int) dataArea.getMaxX(), y);</span>
<span class="nc" id="L2651">            }</span>
            else {
<span class="nc" id="L2653">                this.horizontalTraceLine = new Line2D.Float(</span>
<span class="nc" id="L2654">                        (int) dataArea.getMinX(), y, (int) dataArea.getMaxX(),</span>
<span class="nc" id="L2655">                        y);</span>
            }
<span class="nc" id="L2657">            g2.draw(this.horizontalTraceLine);</span>
        }

        // Reset to the default 'overwrite' mode
<span class="nc" id="L2661">        g2.setPaintMode();</span>
<span class="nc" id="L2662">    }</span>

    /**
     * Displays a dialog that allows the user to edit the properties for the
     * current chart.
     *
     * @since 1.0.3
     */
    public void doEditChartProperties() {

<span class="nc" id="L2672">        ChartEditor editor = ChartEditorManager.getChartEditor(this.chart);</span>
<span class="nc" id="L2673">        int result = JOptionPane.showConfirmDialog(this, editor,</span>
<span class="nc" id="L2674">                localizationResources.getString(&quot;Chart_Properties&quot;),</span>
<span class="nc" id="L2675">                JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);</span>
<span class="nc bnc" id="L2676" title="All 2 branches missed.">        if (result == JOptionPane.OK_OPTION) {</span>
<span class="nc" id="L2677">            editor.updateChart(this.chart);</span>
        }

<span class="nc" id="L2680">    }</span>

    /**
     * Copies the current chart to the system clipboard.
     * 
     * @since 1.0.13
     */
    public void doCopy() {
<span class="nc" id="L2688">        Clipboard systemClipboard</span>
<span class="nc" id="L2689">                = Toolkit.getDefaultToolkit().getSystemClipboard();</span>
<span class="nc" id="L2690">        Insets insets = getInsets();</span>
<span class="nc" id="L2691">        int w = getWidth() - insets.left - insets.right;</span>
<span class="nc" id="L2692">        int h = getHeight() - insets.top - insets.bottom;</span>
<span class="nc" id="L2693">        ChartTransferable selection = new ChartTransferable(this.chart, w, h,</span>
<span class="nc" id="L2694">                getMinimumDrawWidth(), getMinimumDrawHeight(),</span>
<span class="nc" id="L2695">                getMaximumDrawWidth(), getMaximumDrawHeight(), true);</span>
<span class="nc" id="L2696">        systemClipboard.setContents(selection, null);</span>
<span class="nc" id="L2697">    }</span>

    /**
     * Opens a file chooser and gives the user an opportunity to save the chart
     * in PNG format.
     *
     * @throws IOException if there is an I/O error.
     */
    public void doSaveAs() throws IOException {
<span class="nc" id="L2706">        JFileChooser fileChooser = new JFileChooser();</span>
<span class="nc" id="L2707">        fileChooser.setCurrentDirectory(this.defaultDirectoryForSaveAs);</span>
<span class="nc" id="L2708">        FileNameExtensionFilter filter = new FileNameExtensionFilter(</span>
<span class="nc" id="L2709">                    localizationResources.getString(&quot;PNG_Image_Files&quot;), &quot;png&quot;);</span>
<span class="nc" id="L2710">        fileChooser.addChoosableFileFilter(filter);</span>
<span class="nc" id="L2711">        fileChooser.setFileFilter(filter);</span>

<span class="nc" id="L2713">        int option = fileChooser.showSaveDialog(this);</span>
<span class="nc bnc" id="L2714" title="All 2 branches missed.">        if (option == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L2715">            String filename = fileChooser.getSelectedFile().getPath();</span>
<span class="nc bnc" id="L2716" title="All 2 branches missed.">            if (isEnforceFileExtensions()) {</span>
<span class="nc bnc" id="L2717" title="All 2 branches missed.">                if (!filename.endsWith(&quot;.png&quot;)) {</span>
<span class="nc" id="L2718">                    filename = filename + &quot;.png&quot;;</span>
                }
            }
<span class="nc" id="L2721">            ChartUtilities.saveChartAsPNG(new File(filename), this.chart,</span>
<span class="nc" id="L2722">                    getWidth(), getHeight());</span>
        }
<span class="nc" id="L2724">    }</span>
    
    /**
     * Saves the chart in SVG format (a filechooser will be displayed so that
     * the user can specify the filename).  Note that this method only works
     * if the JFreeSVG library is on the classpath...if this library is not 
     * present, the method will fail.
     */
    private void saveAsSVG(File f) throws IOException {
<span class="nc" id="L2733">        File file = f;</span>
<span class="nc bnc" id="L2734" title="All 2 branches missed.">        if (file == null) {</span>
<span class="nc" id="L2735">            JFileChooser fileChooser = new JFileChooser();</span>
<span class="nc" id="L2736">            fileChooser.setCurrentDirectory(this.defaultDirectoryForSaveAs);</span>
<span class="nc" id="L2737">            FileNameExtensionFilter filter = new FileNameExtensionFilter(</span>
<span class="nc" id="L2738">                    localizationResources.getString(&quot;SVG_Files&quot;), &quot;svg&quot;);</span>
<span class="nc" id="L2739">            fileChooser.addChoosableFileFilter(filter);</span>
<span class="nc" id="L2740">            fileChooser.setFileFilter(filter);</span>

<span class="nc" id="L2742">            int option = fileChooser.showSaveDialog(this);</span>
<span class="nc bnc" id="L2743" title="All 2 branches missed.">            if (option == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L2744">                String filename = fileChooser.getSelectedFile().getPath();</span>
<span class="nc bnc" id="L2745" title="All 2 branches missed.">                if (isEnforceFileExtensions()) {</span>
<span class="nc bnc" id="L2746" title="All 2 branches missed.">                    if (!filename.endsWith(&quot;.svg&quot;)) {</span>
<span class="nc" id="L2747">                        filename = filename + &quot;.svg&quot;;</span>
                    }
                }
<span class="nc" id="L2750">                file = new File(filename);</span>
<span class="nc bnc" id="L2751" title="All 2 branches missed.">                if (file.exists()) {</span>
<span class="nc" id="L2752">                    String fileExists = localizationResources.getString(</span>
<span class="nc" id="L2753">                            &quot;FILE_EXISTS_CONFIRM_OVERWRITE&quot;);</span>
<span class="nc" id="L2754">                    int response = JOptionPane.showConfirmDialog(this, </span>
<span class="nc" id="L2755">                            fileExists, &quot;Save As SVG&quot;, </span>
<span class="nc" id="L2756">                            JOptionPane.OK_CANCEL_OPTION);</span>
<span class="nc bnc" id="L2757" title="All 2 branches missed.">                    if (response == JOptionPane.CANCEL_OPTION) {</span>
<span class="nc" id="L2758">                        file = null;</span>
                    }
                }
            }
        }
        
<span class="nc bnc" id="L2764" title="All 2 branches missed.">        if (file != null) {</span>
            // use reflection to get the SVG string
<span class="nc" id="L2766">            String svg = generateSVG(getWidth(), getHeight());</span>
<span class="nc" id="L2767">            BufferedWriter writer = null;</span>
            try {
<span class="nc" id="L2769">                writer = new BufferedWriter(new FileWriter(file));</span>
<span class="nc" id="L2770">                writer.write(&quot;&lt;!DOCTYPE svg PUBLIC \&quot;-//W3C//DTD SVG 1.1//EN\&quot; \&quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\&quot;&gt;\n&quot;);</span>
<span class="nc" id="L2771">                writer.write(svg + &quot;\n&quot;);</span>
<span class="nc" id="L2772">                writer.flush();</span>
<span class="nc" id="L2773">            } finally {</span>
                try {
<span class="nc bnc" id="L2775" title="All 2 branches missed.">                    if (writer != null) {</span>
<span class="nc" id="L2776">                        writer.close();</span>
                    }
<span class="nc" id="L2778">                } catch (IOException ex) {</span>
<span class="nc" id="L2779">                    throw new RuntimeException(ex);</span>
                }
            } 

        }
<span class="nc" id="L2784">    }</span>
    
    /**
     * Generates a string containing a rendering of the chart in SVG format.
     * This feature is only supported if the JFreeSVG library is included on 
     * the classpath.
     * 
     * @return A string containing an SVG element for the current chart, or 
     *     &lt;code&gt;null&lt;/code&gt; if there is a problem with the method invocation
     *     by reflection.
     */
    private String generateSVG(int width, int height) {
<span class="nc" id="L2796">        Graphics2D g2 = createSVGGraphics2D(width, height);</span>
<span class="nc bnc" id="L2797" title="All 2 branches missed.">        if (g2 == null) {</span>
<span class="nc" id="L2798">            throw new IllegalStateException(&quot;JFreeSVG library is not present.&quot;);</span>
        }
        // we suppress shadow generation, because SVG is a vector format and
        // the shadow effect is applied via bitmap effects...
<span class="nc" id="L2802">        g2.setRenderingHint(JFreeChart.KEY_SUPPRESS_SHADOW_GENERATION, true);</span>
<span class="nc" id="L2803">        String svg = null;</span>
<span class="nc" id="L2804">        Rectangle2D drawArea = new Rectangle2D.Double(0, 0, width, height);</span>
<span class="nc" id="L2805">        this.chart.draw(g2, drawArea);</span>
        try {
<span class="nc" id="L2807">            Method m = g2.getClass().getMethod(&quot;getSVGElement&quot;);</span>
<span class="nc" id="L2808">            svg = (String) m.invoke(g2);</span>
<span class="nc" id="L2809">        } catch (NoSuchMethodException e) {</span>
            // null will be returned
<span class="nc" id="L2811">        } catch (SecurityException e) {</span>
            // null will be returned
<span class="nc" id="L2813">        } catch (IllegalAccessException e) {</span>
            // null will be returned
<span class="nc" id="L2815">        } catch (IllegalArgumentException e) {</span>
            // null will be returned
<span class="nc" id="L2817">        } catch (InvocationTargetException e) {</span>
            // null will be returned
        }
<span class="nc" id="L2820">        return svg;</span>
    }

    private Graphics2D createSVGGraphics2D(int w, int h) {
        try {
<span class="nc" id="L2825">            Class svgGraphics2d = Class.forName(&quot;org.jfree.graphics2d.svg.SVGGraphics2D&quot;);</span>
<span class="nc" id="L2826">            Constructor ctor = svgGraphics2d.getConstructor(int.class, int.class);</span>
<span class="nc" id="L2827">            return (Graphics2D) ctor.newInstance(w, h);</span>
<span class="nc" id="L2828">        } catch (ClassNotFoundException ex) {</span>
<span class="nc" id="L2829">            return null;</span>
<span class="nc" id="L2830">        } catch (NoSuchMethodException ex) {</span>
<span class="nc" id="L2831">            return null;</span>
<span class="nc" id="L2832">        } catch (SecurityException ex) {</span>
<span class="nc" id="L2833">            return null;</span>
<span class="nc" id="L2834">        } catch (InstantiationException ex) {</span>
<span class="nc" id="L2835">            return null;</span>
<span class="nc" id="L2836">        } catch (IllegalAccessException ex) {</span>
<span class="nc" id="L2837">            return null;</span>
<span class="nc" id="L2838">        } catch (IllegalArgumentException ex) {</span>
<span class="nc" id="L2839">            return null;</span>
<span class="nc" id="L2840">        } catch (InvocationTargetException ex) {</span>
<span class="nc" id="L2841">            return null;</span>
        }
    }

    /**
     * Saves the chart in PDF format (a filechooser will be displayed so that
     * the user can specify the filename).  Note that this method only works
     * if the OrsonPDF library is on the classpath...if this library is not
     * present, the method will fail.
     */
    private void saveAsPDF(File f) {
<span class="nc" id="L2852">        File file = f;</span>
<span class="nc bnc" id="L2853" title="All 2 branches missed.">        if (file == null) {</span>
<span class="nc" id="L2854">            JFileChooser fileChooser = new JFileChooser();</span>
<span class="nc" id="L2855">            fileChooser.setCurrentDirectory(this.defaultDirectoryForSaveAs);</span>
<span class="nc" id="L2856">            FileNameExtensionFilter filter = new FileNameExtensionFilter(</span>
<span class="nc" id="L2857">                    localizationResources.getString(&quot;PDF_Files&quot;), &quot;pdf&quot;);</span>
<span class="nc" id="L2858">            fileChooser.addChoosableFileFilter(filter);</span>
<span class="nc" id="L2859">            fileChooser.setFileFilter(filter);</span>

<span class="nc" id="L2861">            int option = fileChooser.showSaveDialog(this);</span>
<span class="nc bnc" id="L2862" title="All 2 branches missed.">            if (option == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L2863">                String filename = fileChooser.getSelectedFile().getPath();</span>
<span class="nc bnc" id="L2864" title="All 2 branches missed.">                if (isEnforceFileExtensions()) {</span>
<span class="nc bnc" id="L2865" title="All 2 branches missed.">                    if (!filename.endsWith(&quot;.pdf&quot;)) {</span>
<span class="nc" id="L2866">                        filename = filename + &quot;.pdf&quot;;</span>
                    }
                }
<span class="nc" id="L2869">                file = new File(filename);</span>
<span class="nc bnc" id="L2870" title="All 2 branches missed.">                if (file.exists()) {</span>
<span class="nc" id="L2871">                    String fileExists = localizationResources.getString(</span>
<span class="nc" id="L2872">                            &quot;FILE_EXISTS_CONFIRM_OVERWRITE&quot;);</span>
<span class="nc" id="L2873">                    int response = JOptionPane.showConfirmDialog(this, </span>
<span class="nc" id="L2874">                            fileExists, &quot;Save As PDF&quot;, </span>
<span class="nc" id="L2875">                            JOptionPane.OK_CANCEL_OPTION);</span>
<span class="nc bnc" id="L2876" title="All 2 branches missed.">                    if (response == JOptionPane.CANCEL_OPTION) {</span>
<span class="nc" id="L2877">                        file = null;</span>
                    }
                }
            }
        }
        
<span class="nc bnc" id="L2883" title="All 2 branches missed.">        if (file != null) {</span>
<span class="nc" id="L2884">            writeAsPDF(file, getWidth(), getHeight());</span>
        }
<span class="nc" id="L2886">    }</span>

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if OrsonPDF is on the classpath, and 
     * &lt;code&gt;false&lt;/code&gt; otherwise.  The OrsonPDF library can be found at
     * http://www.object-refinery.com/pdf/
     * 
     * @return A boolean.
     */
    private boolean isOrsonPDFAvailable() {
<span class="nc" id="L2896">        Class pdfDocumentClass = null;</span>
        try {
<span class="nc" id="L2898">            pdfDocumentClass = Class.forName(&quot;com.orsonpdf.PDFDocument&quot;);</span>
<span class="nc" id="L2899">        } catch (ClassNotFoundException e) {</span>
            // pdfDocument class will be null so the function will return false
        }
<span class="nc bnc" id="L2902" title="All 2 branches missed.">        return (pdfDocumentClass != null);</span>
    }
    
    /**
     * Writes the current chart to the specified file in PDF format.  This 
     * will only work when the OrsonPDF library is found on the classpath.
     * Reflection is used to ensure there is no compile-time dependency on
     * OrsonPDF (which is non-free software).
     * 
     * @param file  the output file (&lt;code&gt;null&lt;/code&gt; not permitted).
     * @param w  the chart width.
     * @param h  the chart height.
     */
    private void writeAsPDF(File file, int w, int h) {
<span class="nc bnc" id="L2916" title="All 2 branches missed.">        if (!isOrsonPDFAvailable()) {</span>
<span class="nc" id="L2917">            throw new IllegalStateException(</span>
<span class="nc" id="L2918">                    &quot;OrsonPDF is not present on the classpath.&quot;);</span>
        }
<span class="nc" id="L2920">        ParamChecks.nullNotPermitted(file, &quot;file&quot;);</span>
        try {
<span class="nc" id="L2922">            Class pdfDocClass = Class.forName(&quot;com.orsonpdf.PDFDocument&quot;);</span>
<span class="nc" id="L2923">            Object pdfDoc = pdfDocClass.newInstance();</span>
<span class="nc" id="L2924">            Method m = pdfDocClass.getMethod(&quot;createPage&quot;, Rectangle2D.class);</span>
<span class="nc" id="L2925">            Rectangle2D rect = new Rectangle(w, h);</span>
<span class="nc" id="L2926">            Object page = m.invoke(pdfDoc, rect);</span>
<span class="nc" id="L2927">            Method m2 = page.getClass().getMethod(&quot;getGraphics2D&quot;);</span>
<span class="nc" id="L2928">            Graphics2D g2 = (Graphics2D) m2.invoke(page);</span>
            // we suppress shadow generation, because PDF is a vector format and
            // the shadow effect is applied via bitmap effects...
<span class="nc" id="L2931">            g2.setRenderingHint(JFreeChart.KEY_SUPPRESS_SHADOW_GENERATION, true);</span>
<span class="nc" id="L2932">            Rectangle2D drawArea = new Rectangle2D.Double(0, 0, w, h);</span>
<span class="nc" id="L2933">            this.chart.draw(g2, drawArea);</span>
<span class="nc" id="L2934">            Method m3 = pdfDocClass.getMethod(&quot;writeToFile&quot;, File.class);</span>
<span class="nc" id="L2935">            m3.invoke(pdfDoc, file);</span>
<span class="nc" id="L2936">        } catch (ClassNotFoundException ex) {</span>
<span class="nc" id="L2937">            throw new RuntimeException(ex);</span>
<span class="nc" id="L2938">        } catch (InstantiationException ex) {</span>
<span class="nc" id="L2939">            throw new RuntimeException(ex);</span>
<span class="nc" id="L2940">        } catch (IllegalAccessException ex) {</span>
<span class="nc" id="L2941">            throw new RuntimeException(ex);</span>
<span class="nc" id="L2942">        } catch (NoSuchMethodException ex) {</span>
<span class="nc" id="L2943">            throw new RuntimeException(ex);</span>
<span class="nc" id="L2944">        } catch (SecurityException ex) {</span>
<span class="nc" id="L2945">            throw new RuntimeException(ex);</span>
<span class="nc" id="L2946">        } catch (IllegalArgumentException ex) {</span>
<span class="nc" id="L2947">            throw new RuntimeException(ex);</span>
<span class="nc" id="L2948">        } catch (InvocationTargetException ex) {</span>
<span class="nc" id="L2949">            throw new RuntimeException(ex);</span>
        }
<span class="nc" id="L2951">    }</span>

    /**
     * Creates a print job for the chart.
     */
    public void createChartPrintJob() {
<span class="nc" id="L2957">        PrinterJob job = PrinterJob.getPrinterJob();</span>
<span class="nc" id="L2958">        PageFormat pf = job.defaultPage();</span>
<span class="nc" id="L2959">        PageFormat pf2 = job.pageDialog(pf);</span>
<span class="nc bnc" id="L2960" title="All 2 branches missed.">        if (pf2 != pf) {</span>
<span class="nc" id="L2961">            job.setPrintable(this, pf2);</span>
<span class="nc bnc" id="L2962" title="All 2 branches missed.">            if (job.printDialog()) {</span>
                try {
<span class="nc" id="L2964">                    job.print();</span>
<span class="nc" id="L2965">                }</span>
<span class="nc" id="L2966">                catch (PrinterException e) {</span>
<span class="nc" id="L2967">                    JOptionPane.showMessageDialog(this, e);</span>
                }
            }
        }
<span class="nc" id="L2971">    }</span>

    /**
     * Prints the chart on a single page.
     *
     * @param g  the graphics context.
     * @param pf  the page format to use.
     * @param pageIndex  the index of the page. If not &lt;code&gt;0&lt;/code&gt;, nothing
     *                   gets print.
     *
     * @return The result of printing.
     */
    @Override
    public int print(Graphics g, PageFormat pf, int pageIndex) {

<span class="nc bnc" id="L2986" title="All 2 branches missed.">        if (pageIndex != 0) {</span>
<span class="nc" id="L2987">            return NO_SUCH_PAGE;</span>
        }
<span class="nc" id="L2989">        Graphics2D g2 = (Graphics2D) g;</span>
<span class="nc" id="L2990">        double x = pf.getImageableX();</span>
<span class="nc" id="L2991">        double y = pf.getImageableY();</span>
<span class="nc" id="L2992">        double w = pf.getImageableWidth();</span>
<span class="nc" id="L2993">        double h = pf.getImageableHeight();</span>
<span class="nc" id="L2994">        this.chart.draw(g2, new Rectangle2D.Double(x, y, w, h), this.anchor,</span>
<span class="nc" id="L2995">                null);</span>
<span class="nc" id="L2996">        return PAGE_EXISTS;</span>

    }

    /**
     * Adds a listener to the list of objects listening for chart mouse events.
     *
     * @param listener  the listener (&lt;code&gt;null&lt;/code&gt; not permitted).
     */
    public void addChartMouseListener(ChartMouseListener listener) {
<span class="nc" id="L3006">        ParamChecks.nullNotPermitted(listener, &quot;listener&quot;);</span>
<span class="nc" id="L3007">        this.chartMouseListeners.add(ChartMouseListener.class, listener);</span>
<span class="nc" id="L3008">    }</span>

    /**
     * Removes a listener from the list of objects listening for chart mouse
     * events.
     *
     * @param listener  the listener.
     */
    public void removeChartMouseListener(ChartMouseListener listener) {
<span class="nc" id="L3017">        this.chartMouseListeners.remove(ChartMouseListener.class, listener);</span>
<span class="nc" id="L3018">    }</span>

    /**
     * Returns an array of the listeners of the given type registered with the
     * panel.
     *
     * @param listenerType  the listener type.
     *
     * @return An array of listeners.
     */
    @Override
    public EventListener[] getListeners(Class listenerType) {
<span class="nc bnc" id="L3030" title="All 2 branches missed.">        if (listenerType == ChartMouseListener.class) {</span>
            // fetch listeners from local storage
<span class="nc" id="L3032">            return this.chartMouseListeners.getListeners(listenerType);</span>
        }
        else {
<span class="nc" id="L3035">            return super.getListeners(listenerType);</span>
        }
    }

    /**
     * Creates a popup menu for the panel.
     *
     * @param properties  include a menu item for the chart property editor.
     * @param save  include a menu item for saving the chart.
     * @param print  include a menu item for printing the chart.
     * @param zoom  include menu items for zooming.
     *
     * @return The popup menu.
     */
    protected JPopupMenu createPopupMenu(boolean properties, boolean save,
            boolean print, boolean zoom) {
<span class="nc" id="L3051">        return createPopupMenu(properties, false, save, print, zoom);</span>
    }

    /**
     * Creates a popup menu for the panel.
     *
     * @param properties  include a menu item for the chart property editor.
     * @param copy include a menu item for copying to the clipboard.
     * @param save  include a menu item for saving the chart.
     * @param print  include a menu item for printing the chart.
     * @param zoom  include menu items for zooming.
     *
     * @return The popup menu.
     *
     * @since 1.0.13
     */
    protected JPopupMenu createPopupMenu(boolean properties,
            boolean copy, boolean save, boolean print, boolean zoom) {

<span class="nc" id="L3070">        JPopupMenu result = new JPopupMenu(localizationResources.getString(&quot;Chart&quot;) + &quot;:&quot;);</span>
<span class="nc" id="L3071">        boolean separator = false;</span>

<span class="nc bnc" id="L3073" title="All 2 branches missed.">        if (properties) {</span>
<span class="nc" id="L3074">            JMenuItem propertiesItem = new JMenuItem(</span>
<span class="nc" id="L3075">                    localizationResources.getString(&quot;Properties...&quot;));</span>
<span class="nc" id="L3076">            propertiesItem.setActionCommand(PROPERTIES_COMMAND);</span>
<span class="nc" id="L3077">            propertiesItem.addActionListener(this);</span>
<span class="nc" id="L3078">            result.add(propertiesItem);</span>
<span class="nc" id="L3079">            separator = true;</span>
        }

<span class="nc bnc" id="L3082" title="All 2 branches missed.">        if (copy) {</span>
<span class="nc bnc" id="L3083" title="All 2 branches missed.">            if (separator) {</span>
<span class="nc" id="L3084">                result.addSeparator();</span>
            }
<span class="nc" id="L3086">            JMenuItem copyItem = new JMenuItem(</span>
<span class="nc" id="L3087">                    localizationResources.getString(&quot;Copy&quot;));</span>
<span class="nc" id="L3088">            copyItem.setActionCommand(COPY_COMMAND);</span>
<span class="nc" id="L3089">            copyItem.addActionListener(this);</span>
<span class="nc" id="L3090">            result.add(copyItem);</span>
<span class="nc bnc" id="L3091" title="All 2 branches missed.">            separator = !save;</span>
        }

<span class="nc bnc" id="L3094" title="All 2 branches missed.">        if (save) {</span>
<span class="nc bnc" id="L3095" title="All 2 branches missed.">            if (separator) {</span>
<span class="nc" id="L3096">                result.addSeparator();</span>
            }
<span class="nc" id="L3098">            JMenu saveSubMenu = new JMenu(localizationResources.getString(</span>
<span class="nc" id="L3099">                    &quot;Save_as&quot;));</span>
<span class="nc" id="L3100">            JMenuItem pngItem = new JMenuItem(localizationResources.getString(</span>
<span class="nc" id="L3101">                    &quot;PNG...&quot;));</span>
<span class="nc" id="L3102">            pngItem.setActionCommand(&quot;SAVE_AS_PNG&quot;);</span>
<span class="nc" id="L3103">            pngItem.addActionListener(this);</span>
<span class="nc" id="L3104">            saveSubMenu.add(pngItem);</span>
            
<span class="nc bnc" id="L3106" title="All 2 branches missed.">            if (createSVGGraphics2D(10, 10) != null) {</span>
<span class="nc" id="L3107">                JMenuItem svgItem = new JMenuItem(localizationResources.getString(</span>
<span class="nc" id="L3108">                        &quot;SVG...&quot;));</span>
<span class="nc" id="L3109">                svgItem.setActionCommand(&quot;SAVE_AS_SVG&quot;);</span>
<span class="nc" id="L3110">                svgItem.addActionListener(this);</span>
<span class="nc" id="L3111">                saveSubMenu.add(svgItem);                </span>
            }
            
<span class="nc bnc" id="L3114" title="All 2 branches missed.">            if (isOrsonPDFAvailable()) {</span>
<span class="nc" id="L3115">                JMenuItem pdfItem = new JMenuItem(</span>
<span class="nc" id="L3116">                        localizationResources.getString(&quot;PDF...&quot;));</span>
<span class="nc" id="L3117">                pdfItem.setActionCommand(&quot;SAVE_AS_PDF&quot;);</span>
<span class="nc" id="L3118">                pdfItem.addActionListener(this);</span>
<span class="nc" id="L3119">                saveSubMenu.add(pdfItem);</span>
            }
<span class="nc" id="L3121">            result.add(saveSubMenu);</span>
<span class="nc" id="L3122">            separator = true;</span>
        }

<span class="nc bnc" id="L3125" title="All 2 branches missed.">        if (print) {</span>
<span class="nc bnc" id="L3126" title="All 2 branches missed.">            if (separator) {</span>
<span class="nc" id="L3127">                result.addSeparator();</span>
            }
<span class="nc" id="L3129">            JMenuItem printItem = new JMenuItem(</span>
<span class="nc" id="L3130">                    localizationResources.getString(&quot;Print...&quot;));</span>
<span class="nc" id="L3131">            printItem.setActionCommand(PRINT_COMMAND);</span>
<span class="nc" id="L3132">            printItem.addActionListener(this);</span>
<span class="nc" id="L3133">            result.add(printItem);</span>
<span class="nc" id="L3134">            separator = true;</span>
        }

<span class="nc bnc" id="L3137" title="All 2 branches missed.">        if (zoom) {</span>
<span class="nc bnc" id="L3138" title="All 2 branches missed.">            if (separator) {</span>
<span class="nc" id="L3139">                result.addSeparator();</span>
            }

<span class="nc" id="L3142">            JMenu zoomInMenu = new JMenu(</span>
<span class="nc" id="L3143">                    localizationResources.getString(&quot;Zoom_In&quot;));</span>

<span class="nc" id="L3145">            this.zoomInBothMenuItem = new JMenuItem(</span>
<span class="nc" id="L3146">                    localizationResources.getString(&quot;All_Axes&quot;));</span>
<span class="nc" id="L3147">            this.zoomInBothMenuItem.setActionCommand(ZOOM_IN_BOTH_COMMAND);</span>
<span class="nc" id="L3148">            this.zoomInBothMenuItem.addActionListener(this);</span>
<span class="nc" id="L3149">            zoomInMenu.add(this.zoomInBothMenuItem);</span>

<span class="nc" id="L3151">            zoomInMenu.addSeparator();</span>

<span class="nc" id="L3153">            this.zoomInDomainMenuItem = new JMenuItem(</span>
<span class="nc" id="L3154">                    localizationResources.getString(&quot;Domain_Axis&quot;));</span>
<span class="nc" id="L3155">            this.zoomInDomainMenuItem.setActionCommand(ZOOM_IN_DOMAIN_COMMAND);</span>
<span class="nc" id="L3156">            this.zoomInDomainMenuItem.addActionListener(this);</span>
<span class="nc" id="L3157">            zoomInMenu.add(this.zoomInDomainMenuItem);</span>

<span class="nc" id="L3159">            this.zoomInRangeMenuItem = new JMenuItem(</span>
<span class="nc" id="L3160">                    localizationResources.getString(&quot;Range_Axis&quot;));</span>
<span class="nc" id="L3161">            this.zoomInRangeMenuItem.setActionCommand(ZOOM_IN_RANGE_COMMAND);</span>
<span class="nc" id="L3162">            this.zoomInRangeMenuItem.addActionListener(this);</span>
<span class="nc" id="L3163">            zoomInMenu.add(this.zoomInRangeMenuItem);</span>

<span class="nc" id="L3165">            result.add(zoomInMenu);</span>

<span class="nc" id="L3167">            JMenu zoomOutMenu = new JMenu(</span>
<span class="nc" id="L3168">                    localizationResources.getString(&quot;Zoom_Out&quot;));</span>

<span class="nc" id="L3170">            this.zoomOutBothMenuItem = new JMenuItem(</span>
<span class="nc" id="L3171">                    localizationResources.getString(&quot;All_Axes&quot;));</span>
<span class="nc" id="L3172">            this.zoomOutBothMenuItem.setActionCommand(ZOOM_OUT_BOTH_COMMAND);</span>
<span class="nc" id="L3173">            this.zoomOutBothMenuItem.addActionListener(this);</span>
<span class="nc" id="L3174">            zoomOutMenu.add(this.zoomOutBothMenuItem);</span>

<span class="nc" id="L3176">            zoomOutMenu.addSeparator();</span>

<span class="nc" id="L3178">            this.zoomOutDomainMenuItem = new JMenuItem(</span>
<span class="nc" id="L3179">                    localizationResources.getString(&quot;Domain_Axis&quot;));</span>
<span class="nc" id="L3180">            this.zoomOutDomainMenuItem.setActionCommand(</span>
<span class="nc" id="L3181">                    ZOOM_OUT_DOMAIN_COMMAND);</span>
<span class="nc" id="L3182">            this.zoomOutDomainMenuItem.addActionListener(this);</span>
<span class="nc" id="L3183">            zoomOutMenu.add(this.zoomOutDomainMenuItem);</span>

<span class="nc" id="L3185">            this.zoomOutRangeMenuItem = new JMenuItem(</span>
<span class="nc" id="L3186">                    localizationResources.getString(&quot;Range_Axis&quot;));</span>
<span class="nc" id="L3187">            this.zoomOutRangeMenuItem.setActionCommand(ZOOM_OUT_RANGE_COMMAND);</span>
<span class="nc" id="L3188">            this.zoomOutRangeMenuItem.addActionListener(this);</span>
<span class="nc" id="L3189">            zoomOutMenu.add(this.zoomOutRangeMenuItem);</span>

<span class="nc" id="L3191">            result.add(zoomOutMenu);</span>

<span class="nc" id="L3193">            JMenu autoRangeMenu = new JMenu(</span>
<span class="nc" id="L3194">                    localizationResources.getString(&quot;Auto_Range&quot;));</span>

<span class="nc" id="L3196">            this.zoomResetBothMenuItem = new JMenuItem(</span>
<span class="nc" id="L3197">                    localizationResources.getString(&quot;All_Axes&quot;));</span>
<span class="nc" id="L3198">            this.zoomResetBothMenuItem.setActionCommand(</span>
<span class="nc" id="L3199">                    ZOOM_RESET_BOTH_COMMAND);</span>
<span class="nc" id="L3200">            this.zoomResetBothMenuItem.addActionListener(this);</span>
<span class="nc" id="L3201">            autoRangeMenu.add(this.zoomResetBothMenuItem);</span>

<span class="nc" id="L3203">            autoRangeMenu.addSeparator();</span>
<span class="nc" id="L3204">            this.zoomResetDomainMenuItem = new JMenuItem(</span>
<span class="nc" id="L3205">                    localizationResources.getString(&quot;Domain_Axis&quot;));</span>
<span class="nc" id="L3206">            this.zoomResetDomainMenuItem.setActionCommand(</span>
<span class="nc" id="L3207">                    ZOOM_RESET_DOMAIN_COMMAND);</span>
<span class="nc" id="L3208">            this.zoomResetDomainMenuItem.addActionListener(this);</span>
<span class="nc" id="L3209">            autoRangeMenu.add(this.zoomResetDomainMenuItem);</span>

<span class="nc" id="L3211">            this.zoomResetRangeMenuItem = new JMenuItem(</span>
<span class="nc" id="L3212">                    localizationResources.getString(&quot;Range_Axis&quot;));</span>
<span class="nc" id="L3213">            this.zoomResetRangeMenuItem.setActionCommand(</span>
<span class="nc" id="L3214">                    ZOOM_RESET_RANGE_COMMAND);</span>
<span class="nc" id="L3215">            this.zoomResetRangeMenuItem.addActionListener(this);</span>
<span class="nc" id="L3216">            autoRangeMenu.add(this.zoomResetRangeMenuItem);</span>

<span class="nc" id="L3218">            result.addSeparator();</span>
<span class="nc" id="L3219">            result.add(autoRangeMenu);</span>

        }

<span class="nc" id="L3223">        return result;</span>

    }

    /**
     * The idea is to modify the zooming options depending on the type of chart
     * being displayed by the panel.
     *
     * @param x  horizontal position of the popup.
     * @param y  vertical position of the popup.
     */
    protected void displayPopupMenu(int x, int y) {

<span class="nc bnc" id="L3236" title="All 2 branches missed.">        if (this.popup == null) {</span>
<span class="nc" id="L3237">            return;</span>
        }

        // go through each zoom menu item and decide whether or not to
        // enable it...
<span class="nc" id="L3242">        boolean isDomainZoomable = false;</span>
<span class="nc" id="L3243">        boolean isRangeZoomable = false;</span>
<span class="nc bnc" id="L3244" title="All 2 branches missed.">        Plot plot = (this.chart != null ? this.chart.getPlot() : null);</span>
<span class="nc bnc" id="L3245" title="All 2 branches missed.">        if (plot instanceof Zoomable) {</span>
<span class="nc" id="L3246">            Zoomable z = (Zoomable) plot;</span>
<span class="nc" id="L3247">            isDomainZoomable = z.isDomainZoomable();</span>
<span class="nc" id="L3248">            isRangeZoomable = z.isRangeZoomable();</span>
        }

<span class="nc bnc" id="L3251" title="All 2 branches missed.">        if (this.zoomInDomainMenuItem != null) {</span>
<span class="nc" id="L3252">            this.zoomInDomainMenuItem.setEnabled(isDomainZoomable);</span>
        }
<span class="nc bnc" id="L3254" title="All 2 branches missed.">        if (this.zoomOutDomainMenuItem != null) {</span>
<span class="nc" id="L3255">            this.zoomOutDomainMenuItem.setEnabled(isDomainZoomable);</span>
        }
<span class="nc bnc" id="L3257" title="All 2 branches missed.">        if (this.zoomResetDomainMenuItem != null) {</span>
<span class="nc" id="L3258">            this.zoomResetDomainMenuItem.setEnabled(isDomainZoomable);</span>
        }

<span class="nc bnc" id="L3261" title="All 2 branches missed.">        if (this.zoomInRangeMenuItem != null) {</span>
<span class="nc" id="L3262">            this.zoomInRangeMenuItem.setEnabled(isRangeZoomable);</span>
        }
<span class="nc bnc" id="L3264" title="All 2 branches missed.">        if (this.zoomOutRangeMenuItem != null) {</span>
<span class="nc" id="L3265">            this.zoomOutRangeMenuItem.setEnabled(isRangeZoomable);</span>
        }

<span class="nc bnc" id="L3268" title="All 2 branches missed.">        if (this.zoomResetRangeMenuItem != null) {</span>
<span class="nc" id="L3269">            this.zoomResetRangeMenuItem.setEnabled(isRangeZoomable);</span>
        }

<span class="nc bnc" id="L3272" title="All 2 branches missed.">        if (this.zoomInBothMenuItem != null) {</span>
<span class="nc bnc" id="L3273" title="All 2 branches missed.">            this.zoomInBothMenuItem.setEnabled(isDomainZoomable</span>
<span class="nc bnc" id="L3274" title="All 2 branches missed.">                    &amp;&amp; isRangeZoomable);</span>
        }
<span class="nc bnc" id="L3276" title="All 2 branches missed.">        if (this.zoomOutBothMenuItem != null) {</span>
<span class="nc bnc" id="L3277" title="All 2 branches missed.">            this.zoomOutBothMenuItem.setEnabled(isDomainZoomable</span>
<span class="nc bnc" id="L3278" title="All 2 branches missed.">                    &amp;&amp; isRangeZoomable);</span>
        }
<span class="nc bnc" id="L3280" title="All 2 branches missed.">        if (this.zoomResetBothMenuItem != null) {</span>
<span class="nc bnc" id="L3281" title="All 2 branches missed.">            this.zoomResetBothMenuItem.setEnabled(isDomainZoomable</span>
<span class="nc bnc" id="L3282" title="All 2 branches missed.">                    &amp;&amp; isRangeZoomable);</span>
        }

<span class="nc" id="L3285">        this.popup.show(this, x, y);</span>

<span class="nc" id="L3287">    }</span>

    /**
     * Updates the UI for a LookAndFeel change.
     */
    @Override
    public void updateUI() {
        // here we need to update the UI for the popup menu, if the panel
        // has one...
<span class="nc bnc" id="L3296" title="All 2 branches missed.">        if (this.popup != null) {</span>
<span class="nc" id="L3297">            SwingUtilities.updateComponentTreeUI(this.popup);</span>
        }
<span class="nc" id="L3299">        super.updateUI();</span>
<span class="nc" id="L3300">    }</span>

    /**
     * Provides serialization support.
     *
     * @param stream  the output stream.
     *
     * @throws IOException  if there is an I/O error.
     */
    private void writeObject(ObjectOutputStream stream) throws IOException {
<span class="nc" id="L3310">        stream.defaultWriteObject();</span>
<span class="nc" id="L3311">        SerialUtilities.writePaint(this.zoomFillPaint, stream);</span>
<span class="nc" id="L3312">        SerialUtilities.writePaint(this.zoomOutlinePaint, stream);</span>
<span class="nc" id="L3313">    }</span>

    /**
     * Provides serialization support.
     *
     * @param stream  the input stream.
     *
     * @throws IOException  if there is an I/O error.
     * @throws ClassNotFoundException  if there is a classpath problem.
     */
    private void readObject(ObjectInputStream stream)
        throws IOException, ClassNotFoundException {
<span class="nc" id="L3325">        stream.defaultReadObject();</span>
<span class="nc" id="L3326">        this.zoomFillPaint = SerialUtilities.readPaint(stream);</span>
<span class="nc" id="L3327">        this.zoomOutlinePaint = SerialUtilities.readPaint(stream);</span>

        // we create a new but empty chartMouseListeners list
<span class="nc" id="L3330">        this.chartMouseListeners = new EventListenerList();</span>

        // register as a listener with sub-components...
<span class="nc bnc" id="L3333" title="All 2 branches missed.">        if (this.chart != null) {</span>
<span class="nc" id="L3334">            this.chart.addChangeListener(this);</span>
        }

<span class="nc" id="L3337">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span>org.jfree.data (Mar 14, 2025 10:05:31â€¯p.m.)</div></body></html>